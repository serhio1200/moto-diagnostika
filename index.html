<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Motopodbor.ru PRO - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥–±–æ—Ä –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Motopodbor.ru PRO">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#6366F1">
    <meta name="description" content="–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –ø–æ–¥–±–æ—Ä –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiM2MzY2RjEiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAxMk0xMiA2TDEyIDE4TTYgMTJIMThaIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiLz4KPC9zdmc+Cjwvc3ZnPgo=">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        :root{--primary-color:#6366F1;--primary-dark:#4F46E5;--secondary-color:#10B981;--danger-color:#EF4444;--warning-color:#F59E0B;--success-color:#10B981;--text-color:#1F2937;--text-light:#6B7280;--bg-color:#F9FAFB;--card-bg:#ffffff;--border-color:#E5E7EB;--shadow:0 4px 20px rgba(0,0,0,0.08);--shadow-hover:0 8px 30px rgba(0,0,0,0.12);--safe-area-inset-bottom:env(safe-area-inset-bottom,0px);--safe-area-inset-top:env(safe-area-inset-top,0px);}[data-theme="dark"]{--primary-color:#818CF8;--primary-dark:#6366F1;--secondary-color:#34D399;--danger-color:#F87171;--warning-color:#FBBF24;--success-color:#34D399;--text-color:#F9FAFB;--text-light:#D1D5DB;--bg-color:#111827;--card-bg:#1F2937;--border-color:#374151;--shadow:0 4px 20px rgba(0,0,0,0.25);--shadow-hover:0 8px 30px rgba(0,0,0,0.35);}*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}body{font-family:-apple-system,BlinkMacSystemFont,'Inter','Segoe UI',Roboto,Oxygen,Ubuntu,sans-serif;background:var(--bg-color);color:var(--text-color);line-height:1.6;min-height:100vh;padding:0;margin:0;transition:background-color 0.3s ease,color 0.3s ease;padding-bottom:var(--safe-area-inset-bottom);padding-top:var(--safe-area-inset-top);}.app-container{max-width:100%;margin:0 auto;background:var(--bg-color);min-height:100vh;position:relative;}.app-header{background:linear-gradient(135deg,var(--primary-color),var(--primary-dark));color:white;padding:20px 16px;text-align:center;position:sticky;top:0;z-index:100;box-shadow:0 4px 20px rgba(0,0,0,0.15);padding-top:calc(20px + var(--safe-area-inset-top));transform:translateZ(0);transition:transform 0.3s ease,box-shadow 0.3s ease;}.app-header.scrolled{transform:translateY(-5px);box-shadow:0 8px 30px rgba(0,0,0,0.25);}.app-header h1{font-size:1.5rem;margin-bottom:6px;font-weight:700;letter-spacing:-0.025em;}.app-header p{opacity:0.9;font-size:0.9rem;font-weight:400;}.nav-tabs{display:flex;background:var(--card-bg);border-bottom:1px solid var(--border-color);position:sticky;top:0;z-index:99;padding:0 4px;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;}.nav-tabs::-webkit-scrollbar{display:none;}.nav-tab{flex:1;min-width:70px;background:none;border:none;padding:14px 6px;text-align:center;font-weight:600;font-size:0.7rem;color:var(--text-light);cursor:pointer;transition:all 0.3s ease;border-bottom:3px solid transparent;border-radius:0;margin:0 1px;white-space:nowrap;display:flex;flex-direction:column;align-items:center;gap:4px;}.nav-tab.active{color:var(--primary-color);border-bottom-color:var(--primary-color);background:rgba(99,102,241,0.05);}.nav-tab:active{background:rgba(99,102,241,0.1);transform:scale(0.98);}.nav-tab .tab-icon{font-size:1.1rem;margin-bottom:2px;}.nav-tab .tab-text{font-size:0.65rem;line-height:1.2;}.tab-content{display:none;padding:20px 16px;animation:fadeIn 0.4s ease;padding-bottom:calc(20px + var(--safe-area-inset-bottom));}.tab-content.active{display:block;}@keyframes fadeIn{from{opacity:0;transform:translateY(15px);}to{opacity:1;transform:translateY(0);}}.card{background:var(--card-bg);border-radius:16px;padding:20px;margin-bottom:20px;box-shadow:var(--shadow);border:1px solid var(--border-color);transition:transform 0.3s ease,box-shadow 0.3s ease;transform:translateZ(0);}.card:hover{box-shadow:var(--shadow-hover);transform:translateY(-5px) translateZ(0);}.card:active{transform:scale(0.995) translateZ(0);}.section-title{font-size:1.1rem;font-weight:700;margin-bottom:16px;color:var(--primary-color);display:flex;align-items:center;gap:8px;letter-spacing:-0.025em;}.form-group{margin-bottom:20px;}.form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;}label{display:block;margin-bottom:8px;font-weight:600;color:var(--text-color);font-size:0.9rem;}input,select,textarea{width:100%;padding:14px;border:2px solid var(--border-color);border-radius:12px;font-size:16px;background:var(--card-bg);color:var(--text-color);transition:all 0.3s ease;font-family:inherit;-webkit-appearance:none;}input:focus,select:focus,textarea:focus{border-color:var(--primary-color);outline:none;box-shadow:0 0 0 3px rgba(99,102,241,0.1);transform:translateY(-2px);}.mileage-row{display:flex;align-items:center;gap:12px;}.mileage-input-group{flex:1;display:flex;flex-direction:column;gap:6px;}.mileage-input-group input{width:100%;padding:14px;border:2px solid var(--border-color);border-radius:12px;font-size:16px;background:var(--card-bg);color:var(--text-color);transition:all 0.3s ease;}.mileage-input-group input:focus{border-color:var(--primary-color);outline:none;box-shadow:0 0 0 3px rgba(99,102,241,0.1);}.mileage-label{font-size:0.75rem;color:var(--text-light);text-align:center;font-weight:500;}.mileage-separator{color:var(--primary-color);font-size:1.2rem;font-weight:bold;padding:0 8px;}@media (max-width:480px){.mileage-row{flex-direction:column;gap:8px;}.mileage-separator{transform:rotate(90deg);padding:4px 0;}}.btn{background:linear-gradient(135deg,var(--primary-color),var(--primary-dark));color:white;border:none;border-radius:12px;padding:16px 20px;font-size:1rem;font-weight:600;cursor:pointer;transition:all 0.3s ease;text-align:center;display:block;width:100%;position:relative;overflow:hidden;transform:translateZ(0);}.btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);transition:left 0.5s;}.btn:hover::before{left:100%;}.btn:hover{transform:translateY(-3px) translateZ(0);box-shadow:0 8px 25px rgba(99,102,241,0.3);}.btn:active{transform:scale(0.98) translateZ(0);}.btn-secondary{background:linear-gradient(135deg,var(--secondary-color),#059669);}.btn-warning{background:linear-gradient(135deg,var(--warning-color),#D97706);}.btn-danger{background:linear-gradient(135deg,var(--danger-color),#DC2626);}.btn-success{background:linear-gradient(135deg,var(--success-color),#059669);}.progress-container{margin:20px 0;}.progress-bar{height:8px;background:var(--border-color);border-radius:4px;overflow:hidden;margin-bottom:10px;box-shadow:inset 0 1px 3px rgba(0,0,0,0.1);}.progress-fill{height:100%;background:linear-gradient(90deg,var(--primary-color),var(--secondary-color));width:0%;transition:width 0.7s cubic-bezier(0.34,1.56,0.64,1);border-radius:4px;position:relative;overflow:hidden;}.progress-fill::after{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.4),transparent);animation:shimmer 2s infinite;}@keyframes shimmer{0%{left:-100%;}100%{left:100%;}}.progress-text{text-align:center;font-size:0.8rem;color:var(--text-light);font-weight:500;}.alert{padding:16px;border-radius:12px;margin:16px 0;font-weight:500;animation:slideIn 0.4s ease;border-left:4px solid;}@keyframes slideIn{from{opacity:0;transform:translateX(-20px);}to{opacity:1;transform:translateX(0);}}.alert-success{background:rgba(16,185,129,0.1);color:var(--success-color);border-left-color:var(--success-color);}.alert-info{background:rgba(99,102,241,0.1);color:var(--primary-color);border-left-color:var(--primary-color);}.alert-warning{background:rgba(245,158,11,0.1);color:var(--warning-color);border-left-color:var(--warning-color);}.output-container{background:var(--card-bg);border-radius:12px;padding:20px;margin-top:20px;border:1px solid var(--border-color);white-space:pre-wrap;font-family:'JetBrains Mono','Fira Code',monospace;font-size:0.85rem;line-height:1.6;max-height:400px;overflow-y:auto;transition:all 0.3s ease;}.output-container:focus{border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(99,102,241,0.1);}.search-box{position:relative;margin-bottom:20px;}.search-box input{padding-left:44px;}.search-icon{position:absolute;left:14px;top:50%;transform:translateY(-50%);color:var(--text-light);z-index:2;}.reports-list{max-height:500px;overflow-y:auto;}.report-item{background:var(--card-bg);border-radius:14px;padding:16px;margin-bottom:10px;border:1px solid var(--border-color);transition:all 0.3s ease;cursor:pointer;transform:translateZ(0);}.report-item:hover{transform:translateY(-5px) translateZ(0);box-shadow:var(--shadow-hover);}.report-item:active{transform:scale(0.99) translateZ(0);}.report-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}.report-title{font-weight:700;font-size:1rem;color:var(--text-color);}.report-meta{display:grid;grid-template-columns:1fr 1fr;gap:10px;font-size:0.8rem;color:var(--text-light);}.report-actions{display:flex;gap:6px;}.action-btn{padding:6px 10px;border:none;border-radius:8px;font-size:0.75rem;cursor:pointer;transition:all 0.3s ease;font-weight:600;transform:translateZ(0);}.action-btn:hover{transform:translateY(-2px) translateZ(0);}.action-btn:active{transform:scale(0.95) translateZ(0);}.stats-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin:20px 0;}.stat-card{background:var(--card-bg);border-radius:14px;padding:16px;text-align:center;box-shadow:var(--shadow);border:1px solid var(--border-color);transition:all 0.3s ease;transform:translateZ(0);}.stat-card:hover{transform:translateY(-5px) translateZ(0);box-shadow:var(--shadow-hover);}.stat-value{font-size:1.5rem;font-weight:800;color:var(--primary-color);margin:6px 0;letter-spacing:-0.025em;}.stat-label{font-size:0.8rem;color:var(--text-light);font-weight:500;}.grid-buttons{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin:16px 0;}.grid-btn{background:var(--card-bg);border:1px solid var(--border-color);border-radius:8px;padding:8px 4px;font-size:0.75rem;cursor:pointer;transition:all 0.3s ease;}.grid-btn.active{background:var(--primary-color);color:white;border-color:var(--primary-color);}@media (max-width:768px){.form-row{grid-template-columns:1fr;}.nav-tab{font-size:0.65rem;padding:12px 4px;}.nav-tab .tab-icon{font-size:1rem;}.stats-grid{grid-template-columns:1fr;}.tab-content{padding:16px 12px;}.card{padding:16px;border-radius:14px;}.app-header{padding:16px 12px;padding-top:calc(16px + var(--safe-area-inset-top));}.app-header h1{font-size:1.3rem;}.section-title{font-size:1rem;}.btn{padding:14px 16px;font-size:0.95rem;}}@media (max-width:480px){.app-header h1{font-size:1.2rem;}.nav-tab .tab-text{font-size:0.6rem;}}@media (max-width:380px){.nav-tabs{padding:0 2px;}.nav-tab{min-width:60px;padding:8px 1px;}.nav-tab .tab-icon{font-size:0.9rem;}.nav-tab .tab-text{font-size:0.55rem;}}.text-center{text-align:center;}.mt-10{margin-top:10px;}.mt-20{margin-top:20px;}.mb-10{margin-bottom:10px;}.mb-20{margin-bottom:20px;}.hidden{display:none!important;}.flex{display:flex;}.items-center{align-items:center;}.justify-between{justify-content:space-between;}.gap-10{gap:10px;}.scroll-to-top{position:fixed;bottom:80px;right:16px;width:50px;height:50px;border-radius:50%;background:var(--primary-color);color:white;border:none;font-size:20px;cursor:pointer;box-shadow:0 4px 20px rgba(0,0,0,0.15);display:none;z-index:1000;transition:all 0.3s ease;align-items:center;justify-content:center;transform:translateZ(0);}.scroll-to-top.visible{display:flex;}.scroll-to-top:hover{transform:translateY(-3px) translateZ(0);box-shadow:0 8px 25px rgba(99,102,241,0.3);}.scroll-to-top:active{transform:scale(0.95) translateZ(0);}.settings-group{margin-bottom:24px;}.settings-label{font-weight:600;margin-bottom:10px;color:var(--text-color);font-size:0.95rem;}.settings-description{font-size:0.8rem;color:var(--text-light);margin-bottom:14px;}.toggle-switch{position:relative;display:inline-block;width:50px;height:26px;}.toggle-switch input{opacity:0;width:0;height:0;}.toggle-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:var(--border-color);transition:.4s;border-radius:34px;}.toggle-slider:before{position:absolute;content:"";height:20px;width:20px;left:3px;bottom:3px;background:white;transition:.4s;border-radius:50%;}input:checked+.toggle-slider{background:var(--primary-color);}input:checked+.toggle-slider:before{transform:translateX(24px);}.toggle-container{display:flex;justify-content:space-between;align-items:center;padding:14px 0;border-bottom:1px solid var(--border-color);}.toggle-label{font-weight:500;color:var(--text-color);}.inspection-fields{background:rgba(99,102,241,0.05);border-radius:12px;padding:16px;margin-top:14px;border:2px dashed var(--primary-color);}.inspection-item{background:var(--card-bg);border-radius:12px;padding:16px;margin-bottom:14px;border:1px solid var(--border-color);transition:all 0.3s ease;position:relative;}.inspection-item.urgent{border-left:4px solid var(--warning-color);}.inspection-item.completed{opacity:0.7;background:rgba(16,185,129,0.05);}.inspection-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px;}.inspection-title{font-weight:700;font-size:1rem;color:var(--text-color);}.inspection-date{font-size:0.85rem;color:var(--text-light);background:var(--primary-color);color:white;padding:4px 8px;border-radius:16px;font-weight:600;}.inspection-details{display:grid;grid-template-columns:1fr 1fr;gap:10px;font-size:0.8rem;margin-bottom:14px;}.inspection-actions{display:flex;gap:6px;}.badge{display:inline-block;padding:4px 8px;border-radius:10px;font-size:0.7rem;font-weight:600;margin-right:6px;margin-bottom:6px;}.badge-warning{background:rgba(245,158,11,0.1);color:var(--warning-color);}.badge-success{background:rgba(16,185,129,0.1);color:var(--success-color);}.badge-info{background:rgba(99,102,241,0.1);color:var(--primary-color);}.pulse{animation:pulse 2s infinite;}@keyframes pulse{0%{transform:scale(1);}50%{transform:scale(1.05);}100%{transform:scale(1);}}.shake{animation:shake 0.5s;}@keyframes shake{0%,100%{transform:translateX(0);}25%{transform:translateX(-6px);}75%{transform:translateX(6px);}}@supports(padding:max(0px)){.app-header,.tab-content,.nav-tabs{padding-left:max(16px,env(safe-area-inset-left));padding-right:max(16px,env(safe-area-inset-right));}.scroll-to-top{right:max(16px,env(safe-area-inset-right));bottom:max(80px,calc(80px+env(safe-area-inset-bottom)));}}.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:10000;padding:20px;}.modal.hidden{display:none;}.modal-content{background:var(--card-bg);border-radius:20px;width:100%;max-width:600px;max-height:90vh;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,0.3);animation:modalSlideIn 0.3s ease;}@keyframes modalSlideIn{from{opacity:0;transform:translateY(-50px) scale(0.9);}to{opacity:1;transform:translateY(0) scale(1);}}.modal-header{display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:1px solid var(--border-color);background:var(--primary-color);color:white;}.modal-header h3{margin:0;font-size:1.2rem;}.modal-close{background:none;border:none;color:white;font-size:24px;cursor:pointer;width:30px;height:30px;display:flex;align-items:center;justify-content:center;}.modal-body{padding:20px;max-height:60vh;overflow-y:auto;}.modal-actions{padding:20px;border-top:1px solid var(--border-color);display:flex;gap:10px;}.report-identifiers{background:rgba(99,102,241,0.05);border-radius:12px;padding:16px;margin-bottom:16px;border:2px solid var(--primary-color);}.identifier-item{display:flex;justify-content:space-between;margin-bottom:8px;padding:8px 0;border-bottom:1px solid var(--border-color);}.identifier-item:last-child{margin-bottom:0;border-bottom:none;}#toastContainer{position:fixed;bottom:calc(20px + var(--safe-area-inset-bottom));left:50%;transform:translateX(-50%);z-index:10001;display:flex;flex-direction:column;gap:8px;pointer-events:none;max-width:90vw;width:400px;}.toast{pointer-events:all;background:var(--card-bg);color:var(--text-color);border:1px solid var(--border-color);border-left:4px solid var(--primary-color);border-radius:12px;padding:16px;box-shadow:var(--shadow-hover);opacity:0;transform:translateY(6px);transition:all .3s ease;font-weight:500;max-width:100%;word-wrap:break-word;}.toast.show{opacity:1;transform:translateY(0);}.toast-success{border-left-color:var(--success-color);}.toast-info{border-left-color:var(--primary-color);}.toast-warning{border-left-color:var(--warning-color);}.save-indicator{position:fixed;top:20px;right:20px;background:var(--success-color);color:white;padding:8px 16px;border-radius:8px;font-size:0.8rem;z-index:10002;opacity:0;transform:translateY(-10px);transition:all 0.3s ease;}.save-indicator.visible{opacity:1;transform:translateY(0);}.tooltip{position:fixed;background:var(--card-bg);color:var(--text-color);padding:12px 16px;border-radius:8px;box-shadow:var(--shadow-hover);border:1px solid var(--border-color);max-width:300px;font-size:0.8rem;line-height:1.4;z-index:10003;pointer-events:none;}.mileage-conversion{font-size:0.75rem;color:var(--text-light);margin-top:4px;font-style:italic;}@media (max-width:480px){#toastContainer{width:95vw;max-width:95vw;}.toast{padding:14px;}}@keyframes errorPulse{0%{box-shadow:0 0 0 0 rgba(239,68,68,0.7);}70%{box-shadow:0 0 0 10px rgba(239,68,68,0);}100%{box-shadow:0 0 0 0 rgba(239,68,68,0);}}.pulse{animation:errorPulse 1.5s infinite;}input:invalid,select:invalid{border-color:var(--danger-color)!important;}.required-field::after{content:" *";color:var(--danger-color);}.toast-close{background:none;border:none;font-size:18px;cursor:pointer;margin-left:auto;padding:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center;color:var(--text-light);}.toast-close:hover{color:var(--text-color);}.inspection-item.priority-high{border-left:4px solid var(--danger-color);}.inspection-item.priority-medium{border-left:4px solid var(--warning-color);}.inspection-item.priority-low{border-left:4px solid var(--success-color);}.priority-badge{font-size:0.7rem;padding:2px 6px;border-radius:8px;font-weight:600;}.priority-high{background:rgba(239,68,68,0.1);color:var(--danger-color);}.priority-medium{background:rgba(245,158,11,0.1);color:var(--warning-color);}.priority-low{background:rgba(16,185,129,0.1);color:var(--success-color);}.photo-upload-section{margin-top:16px;padding:16px;background:rgba(99,102,241,0.05);border-radius:12px;border:2px dashed var(--primary-color);}.photo-upload-label{display:block;margin-bottom:10px;font-weight:600;color:var(--primary-color);}.photo-upload-input{width:100%;padding:12px;border:2px dashed var(--border-color);border-radius:8px;background:var(--card-bg);cursor:pointer;transition:all 0.3s ease;margin-bottom:12px;}.photo-upload-input:hover{border-color:var(--primary-color);background:rgba(99,102,241,0.05);}.photo-preview-container{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:10px;margin-top:12px;}.photo-preview-item{position:relative;border-radius:8px;overflow:hidden;border:2px solid var(--border-color);transition:all 0.3s ease;}.photo-preview-item:hover{border-color:var(--primary-color);transform:scale(1.05);}.photo-preview-img{width:100%;height:80px;object-fit:cover;display:block;}.photo-preview-remove{position:absolute;top:4px;right:4px;background:var(--danger-color);color:white;border:none;border-radius:50%;width:20px;height:20px;font-size:12px;cursor:pointer;display:flex;align-items:center;justify-content:center;}.photo-counter{font-size:0.8rem;color:var(--text-light);margin-top:8px;text-align:center;}.photo-storage-warning{background:rgba(245,158,11,0.1);border:1px solid var(--warning-color);border-radius:8px;padding:10px;margin-top:10px;font-size:0.8rem;color:var(--warning-color);}.pdf-page{width:100%;min-height:280mm;padding:8mm;background:white;position:relative;page-break-after:always;box-sizing:border-box;}.pdf-page:last-child{page-break-after:auto;}.page-break{page-break-before:always;}@media print{.pdf-page{page-break-after:always;}.pdf-page:last-child{page-break-after:auto;}}.inspection-section{border:2px dashed var(--primary-color);border-radius:12px;padding:16px;margin-bottom:20px;background:rgba(99,102,241,0.03);}#pdfProgress .modal-content{max-width:500px;}#pdfProgress .progress-container{margin:20px 0;}#pdfPageStatus{text-align:center;margin-top:10px;font-size:0.9rem;color:var(--text-light);}#pdfProgressDetails{font-size:0.8rem;color:var(--text-light);margin-top:5px;text-align:center;}
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>üèçÔ∏è Motopodbor.ru PRO</h1>
            <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥–±–æ—Ä –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤</p>
        </header>
        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="report"><span class="tab-icon">üìä</span><span class="tab-text">–û—Ç—á–µ—Ç</span></button>
            <button class="nav-tab" data-tab="inspections"><span class="tab-icon">üìÖ</span><span class="tab-text">–ü—Ä–æ–≤–µ—Ä–∫–∏</span></button>
            <button class="nav-tab" data-tab="database"><span class="tab-icon">üóÉÔ∏è</span><span class="tab-text">–ë–∞–∑–∞</span></button>
            <button class="nav-tab" data-tab="stats"><span class="tab-icon">üìà</span><span class="tab-text">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span></button>
            <button class="nav-tab" data-tab="settings"><span class="tab-icon">‚öôÔ∏è</span><span class="tab-text">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span></button>
        </nav>
        <div id="report-tab" class="tab-content active">
            <div class="card">
                <h2 class="section-title">–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç—á–µ—Ç–∞</h2>
                <div class="progress-container">
                    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
                    <div class="progress-text" id="progressText">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
                </div>
                <div class="alert alert-success hidden" id="successAlert"></div>
                <div class="alert alert-info hidden" id="savingsAlert"></div>
                <form id="diagnosticForm">
                    <div class="section-title">üìã –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
                    <div class="card">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="brand">–ú–∞—Ä–∫–∞ –º–æ—Ç–æ—Ü–∏–∫–ª–∞</label>
                                <select id="brand" name="brand" required>
                                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É --</option>
                                    <option value="Honda">Honda</option>
                                    <option value="Yamaha">Yamaha</option>
                                    <option value="Kawasaki">Kawasaki</option>
                                    <option value="Suzuki">Suzuki</option>
                                    <option value="BMW">BMW</option>
                                    <option value="KTM">KTM</option>
                                    <option value="Ducati">Ducati</option>
                                    <option value="Triumph">Triumph</option>
                                    <option value="Harley-Davidson">Harley-Davidson</option>
                                    <option value="–î—Ä—É–≥–∞—è –º–∞—Ä–∫–∞">–î—Ä—É–≥–∞—è –º–∞—Ä–∫–∞</option>
                                </select>
                                <input type="text" id="brand_custom" name="brand_custom" placeholder="–í–≤–µ–¥–∏—Ç–µ –º–∞—Ä–∫—É" class="hidden mt-10">
                            </div>
                            <div class="form-group">
                                <label for="model">–ú–æ–¥–µ–ª—å</label>
                                <select id="model" name="model" required>
                                    <option value="">-- –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É --</option>
                                </select>
                                <input type="text" id="model_custom" name="model_custom" placeholder="–í–≤–µ–¥–∏—Ç–µ –º–æ–¥–µ–ª—å" class="hidden mt-10">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="year">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞</label>
                                <input type="number" id="year" name="year" placeholder="2023" min="1990" max="2030" required>
                            </div>
                            <div class="form-group">
                                <label for="mileage">–ü—Ä–æ–±–µ–≥</label>
                                <div class="mileage-row">
                                    <div class="mileage-input-group">
                                        <input type="number" id="mileage_km" name="mileage_km" placeholder="—Ç—ã—Å. –∫–º" step="0.1" min="0">
                                        <span class="mileage-label">—Ç—ã—Å. –∫–º</span>
                                    </div>
                                    <div class="mileage-separator">‚áÑ</div>
                                    <div class="mileage-input-group">
                                        <input type="number" id="mileage_miles" name="mileage_miles" placeholder="—Ç—ã—Å. –º–∏–ª—å" step="0.1" min="0">
                                        <span class="mileage-label">—Ç—ã—Å. –º–∏–ª—å</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="vin">VIN / –ù–æ–º–µ—Ä —Ä–∞–º—ã</label>
                                <input type="text" id="vin" name="vin" placeholder="ZAB12345678901234">
                            </div>
                            <div class="form-group">
                                <label for="engine_number">–ú–æ–¥–µ–ª—å / N –¥–≤–∏–≥–∞—Ç–µ–ª—è</label>
                                <input type="text" id="engine_number" name="engine_number" placeholder="CBR600RR / JH2SC4600XM123456">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="license_plate">–ì–æ—Å. –Ω–æ–º–µ—Ä</label>
                                <input type="text" id="license_plate" name="license_plate" placeholder="–ê123–ë–í77">
                            </div>
                            <div class="form-group">
                                <label for="motorcycle_class">–ö–ª–∞—Å—Å –º–æ—Ç–æ—Ü–∏–∫–ª–∞</label>
                                <select id="motorcycle_class" name="motorcycle_class">
                                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å --</option>
                                    <option value="–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ (Sport)">–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ (Sport)</option>
                                    <option value="–ì–æ–ª—ã–µ (Naked)">–ì–æ–ª—ã–µ (Naked)</option>
                                    <option value="–ö—Ä—É–∏–∑–µ—Ä—ã / –ß–æ–ø–ø–µ—Ä—ã">–ö—Ä—É–∏–∑–µ—Ä—ã / –ß–æ–ø–ø–µ—Ä—ã</option>
                                    <option value="–¢—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ (Touring)">–¢—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ (Touring)</option>
                                    <option value="–°–ø–æ—Ä—Ç-—Ç—É—Ä–∏–∑–º (Sport-Touring)">–°–ø–æ—Ä—Ç-—Ç—É—Ä–∏–∑–º (Sport-Touring)</option>
                                    <option value="–ö–ª–∞—Å—Å–∏–∫–∞ / –†–µ—Ç—Ä–æ (Classic)">–ö–ª–∞—Å—Å–∏–∫–∞ / –†–µ—Ç—Ä–æ (Classic)</option>
                                    <option value="–ö–∞—Ñ–µ-—Ä–µ–π—Å–µ—Ä—ã (Cafe Racer)">–ö–∞—Ñ–µ-—Ä–µ–π—Å–µ—Ä—ã (Cafe Racer)</option>
                                    <option value="–ú–æ—Ç–æ–∫—Ä–æ—Å—Å (Motocross)">–ú–æ—Ç–æ–∫—Ä–æ—Å—Å (Motocross)</option>
                                    <option value="–≠–Ω–¥—É—Ä–æ (Enduro)">–≠–Ω–¥—É—Ä–æ (Enduro)</option>
                                    <option value="–¢—Ä—ç–π–ª (Trail)">–¢—Ä—ç–π–ª (Trail)</option>
                                    <option value="–≠–¥–≤–µ–Ω—á–µ—Ä (Adventure)">–≠–¥–≤–µ–Ω—á–µ—Ä (Adventure)</option>
                                    <option value="–°—É–ø–µ—Ä–º–æ—Ç–æ (Supermoto)">–°—É–ø–µ—Ä–º–æ—Ç–æ (Supermoto)</option>
                                    <option value="–°–∫—É—Ç–µ—Ä—ã (Scooter)">–°–∫—É—Ç–µ—Ä—ã (Scooter)</option>
                                    <option value="–ú–æ–ø–µ–¥—ã / –õ–µ–≥–∫–∏–µ –º–æ—Ç–æ—Ü–∏–∫–ª—ã">–ú–æ–ø–µ–¥—ã / –õ–µ–≥–∫–∏–µ –º–æ—Ç–æ—Ü–∏–∫–ª—ã</option>
                                    <option value="–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ –º–æ—Ç–æ—Ü–∏–∫–ª—ã">–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ –º–æ—Ç–æ—Ü–∏–∫–ª—ã</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="gearbox_type">–¢–∏–ø –∫–æ—Ä–æ–±–∫–∏</label>
                                <select id="gearbox_type" name="gearbox_type">
                                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø --</option>
                                    <option value="–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è">–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è</option>
                                    <option value="–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è (DCT / –í–∞—Ä–∏–∞—Ç–æ—Ä)">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è (DCT / –í–∞—Ä–∏–∞—Ç–æ—Ä)</option>
                                    <option value="–ü–æ–ª—É–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è">–ü–æ–ª—É–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="origin_country">–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –º–æ—Ç–æ—Ü–∏–∫–ª–∞</label>
                                <select id="origin_country" name="origin_country">
                                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ --</option>
                                    <option value="–î–∏–ª–µ—Ä—Å–∫–∏–π –ü–¢–° –†–§">–î–∏–ª–µ—Ä—Å–∫–∏–π –ü–¢–° –†–§</option>
                                    <option value="–Ø–ø–æ–Ω–∏—è">–Ø–ø–æ–Ω–∏—è</option>
                                    <option value="–ï–≤—Ä–æ–ø–∞">–ï–≤—Ä–æ–ø–∞</option>
                                    <option value="–°–®–ê / –ê—É–∫—Ü–∏–æ–Ω">–°–®–ê / –ê—É–∫—Ü–∏–æ–Ω</option>
                                    <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="auction_type">–ê—É–∫—Ü–∏–æ–Ω / –ø–æ—Å—Ç–∞–≤–∫–∞</label>
                                <select id="auction_type" name="auction_type">
                                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø --</option>
                                    <option value="–ë–µ–∑ –∞—É–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ –ª–∏—Å—Ç–∞">–ë–µ–∑ –∞—É–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ –ª–∏—Å—Ç–∞</option>
                                    <option value="–ê—É–∫—Ü–∏–æ–Ω –Ø–ø–æ–Ω–∏–∏">–ê—É–∫—Ü–∏–æ–Ω –Ø–ø–æ–Ω–∏–∏</option>
                                    <option value="–ê—É–∫—Ü–∏–æ–Ω –°–®–ê (–±–∏—Ç—ã–π)">–ê—É–∫—Ü–∏–æ–Ω –°–®–ê (–±–∏—Ç—ã–π)</option>
                                    <option value="–ï–≤—Ä–æ–ø–µ–π—Å–∫–∏–π / –¥–∏–ª–µ—Ä">–ï–≤—Ä–æ–ø–µ–π—Å–∫–∏–π / –¥–∏–ª–µ—Ä</option>
                                    <option value="–ß–∞—Å—Ç–Ω–∏–∫ –ø–æ –î–ö–ü">–ß–∞—Å—Ç–Ω–∏–∫ –ø–æ –î–ö–ü</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group hidden" id="auctionLotNumberGroup">
                            <label for="auction_lot_number">–ù–æ–º–µ—Ä –∞—É–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ –∏–ª–∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ –ª–æ—Ç</label>
                            <input type="text" id="auction_lot_number" name="auction_lot_number" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1234567 –∏–ª–∏ https://...">
                        </div>
                    </div>
                    <div class="section-title">üìë –î–æ–∫—É–º–µ–Ω—Ç—ã –∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å</div>
                    <div class="card">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="legal_check">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞</label>
                                <select id="legal_check" name="legal_check">
                                    <option value="–ü—Ä–æ–≤–µ–¥–µ–Ω–∞">‚úÖ –ü—Ä–æ–≤–µ–¥–µ–Ω–∞</option>
                                    <option value="–ù–µ –ø—Ä–æ–≤–æ–¥–∏–ª–∞—Å—å">‚ùå –ù–µ –ø—Ä–æ–≤–æ–¥–∏–ª–∞—Å—å</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="pts_type">–¢–∏–ø –ü–¢–°</label>
                                <select id="pts_type" name="pts_type">
                                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ü–¢–° --</option>
                                    <option value="–ë—É–º–∞–∂–Ω—ã–π –ü–¢–°">–ë—É–º–∞–∂–Ω—ã–π –ü–¢–°</option>
                                    <option value="–î—É–±–ª–∏–∫–∞—Ç –ë—É–º–∞–∂–Ω—ã–π –ü–¢–°">–î—É–±–ª–∏–∫–∞—Ç –ë—É–º–∞–∂–Ω—ã–π –ü–¢–°</option>
                                    <option value="–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–µ (–≠–ü–¢–°)">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–µ (–≠–ü–¢–°)</option>
                                    <option value="–ù–µ –≤—ã–¥–∞–Ω">–ù–µ –≤—ã–¥–∞–Ω</option>
                                    <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="legal_status">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ç—É—Å –º–æ—Ç–æ—Ü–∏–∫–ª–∞</label>
                                <select id="legal_status" name="legal_status">
                                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å --</option>
                                    <option value="–ù–∞ —É—á–µ—Ç–µ –§–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –õ–∏—Ü–∞">–ù–∞ —É—á–µ—Ç–µ –§–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –õ–∏—Ü–∞</option>
                                    <option value="–ù–∞ —É—á–µ—Ç–µ –Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –õ–∏—Ü–∞">–ù–∞ —É—á–µ—Ç–µ –Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –õ–∏—Ü–∞</option>
                                    <option value="–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</option>
                                    <option value="–ü—Ä–æ–¥–∞–∂–∞ –¢–° –Ω–µ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –Ω–∞ —É—á—ë—Ç">–ü—Ä–æ–¥–∞–∂–∞ –¢–° –Ω–µ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –Ω–∞ —É—á—ë—Ç</option>
                                    <option value="–°–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–≥–æ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è">–°–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–≥–æ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è</option>
                                    <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="legal_comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º</label>
                            <textarea id="legal_comment" name="legal_comment" rows="2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –ê–≤—Ç–æ–∫–æ–¥ –∏ –ì–ò–ë–î–î, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–µ—Ç, –ü–¢–° –æ—Ä–∏–≥–∏–Ω–∞–ª..."></textarea>
                        </div>
                    </div>
                    <div class="section-title">üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
                    <div class="card">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="price">–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–≤—Ü–∞</label>
                                <input type="text" id="price" name="price" placeholder="350 —Ç—ã—Å.">
                            </div>
                            <div class="form-group">
                                <label for="objective_cost">–û–±—ä–µ–∫—Ç–∏–≤–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</label>
                                <input type="text" id="objective_cost" name="objective_cost" placeholder="320 —Ç—ã—Å.">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="seller_discount">–°–∫–∏–¥–∫–∞ —Å –ø—Ä–æ–¥–∞–≤—Ü–∞</label>
                                <input type="text" id="seller_discount" name="seller_discount" placeholder="15 —Ç—ã—Å.">
                            </div>
                            <div class="form-group">
                                <label for="investment_cost">–°—Ç–æ–∏–º–æ—Å—Ç—å –≤–ª–æ–∂–µ–Ω–∏–π</label>
                                <input type="text" id="investment_cost" name="investment_cost" placeholder="5 —Ç—ã—Å.">
                            </div>
                        </div>
                    </div>
                    <div class="section-title">üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ—Ç–æ—Ü–∏–∫–ª–∞</div>
                    <div class="card">
                        <!-- –¢–∏—Ç—É–ª—å–Ω—ã–π –ª–∏—Å—Ç -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —Ç–∏—Ç—É–ª—å–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ (–º–∞–∫—Å–∏–º—É–º 1)</label>
                                    <input type="file" class="photo-upload-input" data-section="exterior" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="exterior"></div>
                                    <div class="photo-counter" data-section="exterior">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/1</div>
                                </div>
                            </div>
                        </div>

                        <!-- –û—Å–º–æ—Ç—Ä –û–±—â–∏–π, –í–Ω–µ—à–Ω–∏–π –≤–∏–¥ -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_engine">–û—Å–º–æ—Ç—Ä –û–±—â–∏–π, –í–Ω–µ—à–Ω–∏–π –≤–∏–¥</label>
                                <textarea id="inspection_engine" name="inspection_engine" rows="2" placeholder="–û–±—â–∏–π –æ—Å–º–æ—Ç—Ä –º–æ—Ç–æ—Ü–∏–∫–ª–∞, –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –æ–±—â–µ–≥–æ –æ—Å–º–æ—Ç—Ä–∞ –∏ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="engine" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="engine"></div>
                                    <div class="photo-counter" data-section="engine">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –õ–ö–ü -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_consumables">–°–æ—Å—Ç–æ—è–Ω–∏–µ –õ–ö–ü</label>
                                <textarea id="inspection_consumables" name="inspection_consumables" rows="2" placeholder="–°–æ—Å—Ç–æ—è–Ω–∏–µ –ª–∞–∫–æ–∫—Ä–∞—Å–æ—á–Ω–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –õ–ö–ü (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="consumables" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="consumables"></div>
                                    <div class="photo-counter" data-section="consumables">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –°–∏–¥–µ–Ω—å—è -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_electrical">–°–æ—Å—Ç–æ—è–Ω–∏–µ –°–∏–¥–µ–Ω—å—è</label>
                                <textarea id="inspection_electrical" name="inspection_electrical" rows="2" placeholder="–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–¥–µ–Ω—å—è..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏–¥–µ–Ω—å—è (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="electrical" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="electrical"></div>
                                    <div class="photo-counter" data-section="electrical">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <!-- –û—Å–º–æ—Ç—Ä –û–ø—Ç–∏–∫–∏ -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_suspension">–û—Å–º–æ—Ç—Ä –û–ø—Ç–∏–∫–∏</label>
                                <textarea id="inspection_suspension" name="inspection_suspension" rows="2" placeholder="–°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–ø—Ç–∏–∫–∏: —Ñ–∞—Ä—ã, –ø–æ–≤–æ—Ä–æ—Ç–Ω–∏–∫–∏, —Å—Ç–æ–ø-—Å–∏–≥–Ω–∞–ª—ã..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –æ–ø—Ç–∏–∫–∏ (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="suspension" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="suspension"></div>
                                    <div class="photo-counter" data-section="suspension">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <!-- –†–∞–º–∞, –®–≤—ã, –í—Ç–æ—Ä–∏—á–Ω–∞—è –æ–∫—Ä–∞—Å–∫–∞ -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_fuel_system">–†–∞–º–∞, –®–≤—ã, –í—Ç–æ—Ä–∏—á–Ω–∞—è –æ–∫—Ä–∞—Å–∫–∞</label>
                                <textarea id="inspection_fuel_system" name="inspection_fuel_system" rows="2" placeholder="–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞–º—ã, —à–≤–æ–≤, –≤—Ç–æ—Ä–∏—á–Ω–æ–π –æ–∫—Ä–∞—Å–∫–∏..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ä–∞–º—ã, —à–≤–æ–≤, –æ–∫—Ä–∞—Å–∫–∏ (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="fuel_system" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="fuel_system"></div>
                                    <div class="photo-counter" data-section="fuel_system">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <!-- –ö—Ä–∏–º–∏–Ω–∞–ª, –í–∏–Ω –Ω–æ–º–µ—Ä–∞, –ù–æ–º–µ—Ä–∞ –î–≤–∏–≥–∞—Ç–µ–ª—è -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_brake_system">–ö—Ä–∏–º–∏–Ω–∞–ª, –í–∏–Ω –Ω–æ–º–µ—Ä–∞, –ù–æ–º–µ—Ä–∞ –î–≤–∏–≥–∞—Ç–µ–ª—è</label>
                                <textarea id="inspection_brake_system" name="inspection_brake_system" rows="2" placeholder="–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫—Ä–∏–º–∏–Ω–∞–ª, —Å–≤–µ—Ä–∫–∞ VIN –∏ –Ω–æ–º–µ—Ä–æ–≤ –¥–≤–∏–≥–∞—Ç–µ–ª—è..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ VIN –∏ –Ω–æ–º–µ—Ä–æ–≤ (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="brake_system" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="brake_system"></div>
                                    <div class="photo-counter" data-section="brake_system">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <!-- –ì–µ–æ–º–µ—Ç—Ä–∏—è, –ü–æ–¥—Ä–∞–º–Ω–∏–∫–∞, —Ä—É–ª—è, –≤–∏–ª–∫–∏ -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_cooling_system">–ì–µ–æ–º–µ—Ç—Ä–∏—è, –ü–æ–¥—Ä–∞–º–Ω–∏–∫–∞, —Ä—É–ª—è, –≤–∏–ª–∫–∏</label>
                                <textarea id="inspection_cooling_system" name="inspection_cooling_system" rows="2" placeholder="–ì–µ–æ–º–µ—Ç—Ä–∏—è –ø–æ–¥—Ä–∞–º–Ω–∏–∫–∞, —Ä—É–ª—è, –≤–∏–ª–∫–∏..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≥–µ–æ–º–µ—Ç—Ä–∏–∏ (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="cooling_system" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="cooling_system"></div>
                                    <div class="photo-counter" data-section="cooling_system">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <!-- –û—Ä–≥–∞–Ω—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_controls">–û—Ä–≥–∞–Ω—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</label>
                                <textarea id="inspection_controls" name="inspection_controls" rows="2" placeholder="–°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ä–≥–∞–Ω–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è: —Ä—É—á–∫–∏, –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –æ—Ä–≥–∞–Ω–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="controls" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="controls"></div>
                                    <div class="photo-counter" data-section="controls">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <!-- –ú–æ—Ç–æ—Ä–Ω—ã–π –£–∑–µ–ª -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_additional_equipment">–ú–æ—Ç–æ—Ä–Ω—ã–π –£–∑–µ–ª</label>
                                <textarea id="inspection_additional_equipment" name="inspection_additional_equipment" rows="2" placeholder="–°–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ—Ç–æ—Ä–Ω–æ–≥–æ —É–∑–ª–∞..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –º–æ—Ç–æ—Ä–Ω–æ–≥–æ —É–∑–ª–∞ (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="additional_equipment" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="additional_equipment"></div>
                                    <div class="photo-counter" data-section="additional_equipment">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <!-- –¢–æ–ø–ª–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_bodywork">–¢–æ–ø–ª–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</label>
                                <textarea id="inspection_bodywork" name="inspection_bodywork" rows="2" placeholder="–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ–ø–ª–∏–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ç–æ–ø–ª–∏–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="bodywork" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="bodywork"></div>
                                    <div class="photo-counter" data-section="bodywork">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <!-- –°–∏—Å—Ç–µ–º–∞ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_electrical_new">–°–∏—Å—Ç–µ–º–∞ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è</label>
                                <textarea id="inspection_electrical_new" name="inspection_electrical_new" rows="2" placeholder="–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Å–∏—Å—Ç–µ–º—ã –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="electrical_new" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="electrical_new"></div>
                                    <div class="photo-counter" data-section="electrical_new">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <!-- –≠–ª–µ–∫—Ç—Ä–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_brake_system_new">–≠–ª–µ–∫—Ç—Ä–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</label>
                                <textarea id="inspection_brake_system_new" name="inspection_brake_system_new" rows="2" placeholder="–°–æ—Å—Ç–æ—è–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —ç–ª–µ–∫—Ç—Ä–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="brake_system_new" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="brake_system_new"></div>
                                    <div class="photo-counter" data-section="brake_system_new">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <!-- –¢–æ—Ä–º–æ–∑–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_drive">–¢–æ—Ä–º–æ–∑–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</label>
                                <textarea id="inspection_drive" name="inspection_drive" rows="2" placeholder="–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ—Ä–º–æ–∑–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ç–æ—Ä–º–æ–∑–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="drive" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="drive"></div>
                                    <div class="photo-counter" data-section="drive">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <!-- –ü—Ä–∏–≤–æ–¥ -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_tires">–ü—Ä–∏–≤–æ–¥</label>
                                <textarea id="inspection_tires" name="inspection_tires" rows="2" placeholder="–°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–≤–æ–¥–∞..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø—Ä–∏–≤–æ–¥–∞ (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="tires" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="tires"></div>
                                    <div class="photo-counter" data-section="tires">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <!-- –†–µ–∑–∏–Ω–∞ -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_suspension_front_rear">–†–µ–∑–∏–Ω–∞</label>
                                <textarea id="inspection_suspension_front_rear" name="inspection_suspension_front_rear" rows="2" placeholder="–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–∑–∏–Ω—ã..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ä–µ–∑–∏–Ω—ã (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="suspension_front_rear" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="suspension_front_rear"></div>
                                    <div class="photo-counter" data-section="suspension_front_rear">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <!-- –ü–æ–¥–≤–µ—Å–∫–∞ –ø–µ—Ä–µ–¥, –∑–∞–¥ -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_computer_diagnostics">–ü–æ–¥–≤–µ—Å–∫–∞ –ø–µ—Ä–µ–¥, –∑–∞–¥</label>
                                <textarea id="inspection_computer_diagnostics" name="inspection_computer_diagnostics" rows="2" placeholder="–°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥–Ω–µ–π –∏ –∑–∞–¥–Ω–µ–π –ø–æ–¥–≤–µ—Å–∫–∏..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø–æ–¥–≤–µ—Å–∫–∏ (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="computer_diagnostics" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="computer_diagnostics"></div>
                                    <div class="photo-counter" data-section="computer_diagnostics">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <!-- –ö–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_additional_equipment_new">–ö–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</label>
                                <textarea id="inspection_additional_equipment_new" name="inspection_additional_equipment_new" rows="2" placeholder="–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="additional_equipment_new" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="additional_equipment_new"></div>
                                    <div class="photo-counter" data-section="additional_equipment_new">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_final">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</label>
                                <textarea id="inspection_final" name="inspection_final" rows="2" placeholder="–°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="final" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="final"></div>
                                    <div class="photo-counter" data-section="final">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ -->
                        <div class="inspection-section">
                            <div class="form-group">
                                <label for="inspection_geometry">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</label>
                                <textarea id="inspection_geometry" name="inspection_geometry" rows="2" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –º–æ—Ç–æ—Ü–∏–∫–ª–∞..."></textarea>
                                <div class="photo-upload-section">
                                    <label class="photo-upload-label">üì∑ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (–º–∞–∫—Å–∏–º—É–º 9)</label>
                                    <input type="file" class="photo-upload-input" data-section="geometry" accept="image/*" multiple>
                                    <div class="photo-preview-container" data-section="geometry"></div>
                                    <div class="photo-counter" data-section="geometry">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/9</div>
                                </div>
                            </div>
                        </div>

                        <div class="form-row mt-20">
                            <button type="button" class="btn btn-secondary" id="generatePDFReportBtn">üìä –û—Ç—á–µ—Ç –≤ PDF –¥–ª—è –ö–ª–∏–µ–Ω—Ç–∞</button>
                        </div>
                    </div>
                    <div class="section-title">üí° –í—ã–≤–æ–¥—ã –∏ —Ä–µ—à–µ–Ω–∏–µ</div>
                    <div class="card">
                        <div class="form-group">
                            <label for="key_finding">–ö–ª—é—á–µ–≤–∞—è –Ω–∞—Ö–æ–¥–∫–∞</label>
                            <input type="text" id="key_finding" name="key_finding" placeholder="–û—Ç–ª–∏—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–≤–∏–≥–∞—Ç–µ–ª—è">
                        </div>
                        <div class="form-group">
                            <label for="expert_verdict">–≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –≤–µ—Ä–¥–∏–∫—Ç</label>
                            <textarea id="expert_verdict" name="expert_verdict" rows="3" placeholder="–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –º–Ω–µ–Ω–∏–µ..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="decision">–†–µ—à–µ–Ω–∏–µ</label>
                            <select id="decision" name="decision">
                                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ --</option>
                                <option value="‚úÖ –ö—É–ø–ª–µ–Ω">‚úÖ –ö—É–ø–ª–µ–Ω</option>
                                <option value="‚ùå –ù–µ –ö—É–ø–ª–µ–Ω">‚ùå –ù–µ –ö—É–ø–ª–µ–Ω</option>
                                <option value="üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É">üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É</option>
                                <option value="‚è≥ –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ">‚è≥ –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ</option>
                            </select>
                        </div>
                        <div class="inspection-fields hidden" id="inspectionFields">
                            <div class="section-title" style="font-size: 0.95rem;">üìÖ –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="inspection_date">–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏</label>
                                    <input type="date" id="inspection_date" name="inspection_date">
                                </div>
                                <div class="form-group">
                                    <label for="inspection_time">–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏</label>
                                    <input type="time" id="inspection_time" name="inspection_time">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="inspection_address">–ê–¥—Ä–µ—Å –ø—Ä–æ–≤–µ—Ä–∫–∏</label>
                                <input type="text" id="inspection_address" name="inspection_address" placeholder="–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="customer_phone">–¢–µ–ª–µ—Ñ–æ–Ω –∑–∞–∫–∞–∑—á–∏–∫–∞</label>
                                    <input type="tel" id="customer_phone" name="customer_phone" placeholder="+7 (900) 123-45-67">
                                </div>
                                <div class="form-group">
                                    <label for="seller_phone">–¢–µ–ª–µ—Ñ–æ–Ω –ø—Ä–æ–¥–∞–≤—Ü–∞</label>
                                    <input type="tel" id="seller_phone" name="seller_phone" placeholder="+7 (900) 765-43-21">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="inspection_notes">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏</label>
                                <textarea id="inspection_notes" name="inspection_notes" rows="2" placeholder="–û—Å–æ–±—ã–µ —É—Å–ª–æ–≤–∏—è, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏..."></textarea>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn pulse" id="generateBtn">üîÑ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç</button>
                    <div class="form-row mt-10">
                        <button type="button" class="btn btn-secondary" id="saveToDbBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±–∞–∑—É</button>
                        <button type="button" class="btn btn-warning" id="clearFormBtn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</button>
                    </div>
                </form>
            </div>
            <div class="card hidden" id="outputCard">
                <div class="section-title">üìÑ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç</div>
                <div class="output-container" id="output"></div>
                <button type="button" class="btn btn-success mt-10 hidden" id="copyBtn">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π</button>
            </div>
        </div>
        <div id="inspections-tab" class="tab-content">
            <div class="card">
                <h2 class="section-title">üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏</h2>
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="searchInspections" placeholder="–ü–æ–∏—Å–∫ –ø–æ –º–∞—Ä–∫–µ, –º–æ–¥–µ–ª–∏ –∏–ª–∏ –∞–¥—Ä–µ—Å—É...">
                </div>
                <div class="form-row">
                    <button class="btn btn-success" id="clearCompletedInspectionsBtn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</button>
                </div>
                <div class="reports-list" id="inspectionsList"></div>
            </div>
        </div>
        <div id="database-tab" class="tab-content">
            <div class="card">
                <h2 class="section-title">üóÉÔ∏è –ë–∞–∑–∞ –æ—Ç—á–µ—Ç–æ–≤</h2>
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="searchReports" placeholder="–ü–æ–∏—Å–∫ –ø–æ –º–∞—Ä–∫–µ, –º–æ–¥–µ–ª–∏, VIN –∏–ª–∏ –≥–æ–¥—É...">
                </div>
                <div class="reports-list" id="reportsList"></div>
            </div>
        </div>
        <div id="stats-tab" class="tab-content">
            <div class="card">
                <h2 class="section-title">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="startDate">–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞</label>
                        <input type="date" id="startDate" name="startDate">
                    </div>
                    <div class="form-group">
                        <label for="endDate">–ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞</label>
                        <input type="date" id="endDate" name="endDate">
                    </div>
                </div>
                <button class="btn btn-secondary" id="updateStatsBtn">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">–í—Å–µ–≥–æ –æ—Ç—á–µ—Ç–æ–≤</div>
                        <div class="stat-value" id="totalReports">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–ö–ª–∞—Å—Å –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤</div>
                        <div class="stat-value" id="motorcycleClasses">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–ü–æ–ø—É–ª—è—Ä–Ω–∞—è –º–∞—Ä–∫–∞</div>
                        <div class="stat-value" id="popularBrand">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞</div>
                        <div class="stat-value" id="avgPrice">0</div>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">–ö—É–ø–ª–µ–Ω–æ</div>
                        <div class="stat-value" id="purchasedCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–ù–µ –∫—É–ø–ª–µ–Ω–æ</div>
                        <div class="stat-value" id="notPurchasedCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</div>
                        <div class="stat-value" id="pendingCount">0</div>
                    </div>
                </div>
                <button class="btn btn-secondary" id="generateStatsBtn">üìä –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</button>
                <div class="output-container hidden mt-20" id="statsOutput"></div>
                <button class="btn btn-success mt-10 hidden" id="copyStatsBtn">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
            </div>
        </div>
        <div id="settings-tab" class="tab-content">
            <div class="card">
                <h2 class="section-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
                <div class="settings-group">
                    <div class="settings-label">–í–Ω–µ—à–Ω–∏–π –≤–∏–¥</div>
                    <div class="settings-description">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–µ–º—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</div>
                    <div class="toggle-container">
                        <span class="toggle-label">–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="darkTheme">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-container">
                        <span class="toggle-label">–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoSave" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="settings-group">
                    <div class="settings-label">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
                    <div class="settings-description">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
                    <div class="toggle-container">
                        <span class="toggle-label">–ó–≤—É–∫–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="soundNotifications" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-container">
                        <span class="toggle-label">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–≤–µ—Ä–∫–∞—Ö</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="inspectionNotifications" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="reminder-input" style="display:flex; align-items:center; gap:10px; margin-top:10px;">
                        <label class="reminder-label">–ù–∞–ø–æ–º–∏–Ω–∞—Ç—å –∑–∞:</label>
                        <input type="number" id="reminderTime" name="reminderTime" min="1" max="24" value="2" style="max-width: 80px;">
                        <span class="reminder-label">—á–∞—Å–∞</span>
                    </div>
                </div>
                <div class="settings-group">
                    <div class="settings-label">–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏</div>
                    <div class="settings-description">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</div>
                    <div class="form-row">
                        <button class="btn btn-secondary" id="exportAllDataBtn">üíæ –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</button>
                        <button class="btn btn-warning" id="importAllDataBtn">üì• –ò–º–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</button>
                    </div>
                    <button class="btn btn-danger mt-10" id="clearStorageBtn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
                </div>
            </div>
            <div class="card mt-20">
                <h2 class="section-title">‚ÑπÔ∏è –û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</h2>
                <div class="settings-group">
                    <p><strong>–í–µ—Ä—Å–∏—è:</strong> 2.7.1 PRO FINAL</p>
                    <p><strong>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:</strong> –°–µ—Ä–≥–µ–π –õ–∞–Ω–¥–∏–∫</p>
                    <p><strong>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</strong> 8 950 005-05-08</p>
                    <p><strong>–°–∞–π—Ç:</strong> motopodbor.ru</p>
                    <p><strong>–û–±–Ω–æ–≤–ª–µ–Ω–æ:</strong> <span id="appVersionDate">2024</span></p>
                </div>
                <button class="btn mt-20" id="installBtn" style="display: none;">üì≤ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
            </div>
        </div>
    </div>
    <button class="scroll-to-top" id="scrollToTopBtn" aria-label="–ù–∞–≤–µ—Ä—Ö">‚Üë</button>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç—á–µ—Ç–æ–≤ -->
    <div id="reportModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–∞</h3>
                <button class="modal-close" id="modalClose">√ó</button>
            </div>
            <div class="modal-body">
                <div class="report-identifiers">
                    <div class="identifier-item"><strong>VIN:</strong> <span id="modalVin">–ù–µ —É–∫–∞–∑–∞–Ω</span></div>
                    <div class="identifier-item"><strong>–ú–æ–¥–µ–ª—å / N –¥–≤–∏–≥–∞—Ç–µ–ª—è:</strong> <span id="modalEngineNumber">–ù–µ —É–∫–∞–∑–∞–Ω</span></div>
                    <div class="identifier-item"><strong>–ì–æ—Å. –Ω–æ–º–µ—Ä:</strong> <span id="modalLicensePlate">–ù–µ —É–∫–∞–∑–∞–Ω</span></div>
                    <div class="identifier-item"><strong>–ú–æ—Ç–æ—Ü–∏–∫–ª:</strong> <span id="modalBikeInfo">-</span></div>
                </div>
                <div class="output-container modal-output" id="modalOutput"></div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="copyModalReport">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π</button>
                <button class="btn" id="closeModal">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ PDF -->
    <div id="pdfProgress" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –æ—Ç—á–µ—Ç–∞</h3>
            </div>
            <div class="modal-body">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="pdfProgressFill" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="pdfProgressText">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
                </div>
                <div id="pdfPageStatus" style="text-align: center; margin-top: 10px; font-size: 0.9rem; color: var(--text-light);"></div>
                <div id="pdfProgressDetails" style="font-size: 0.8rem; color: var(--text-light); margin-top: 5px; text-align: center;"></div>
            </div>
        </div>
    </div>
    
    <div class="save-indicator" id="saveIndicator">üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ</div>
    <div id="toastContainer" aria-live="polite" aria-atomic="true"></div>
    <script>
        const app = {
            db: null,
            indexedDB: {
                name: 'MotopodborDB',
                version: 3,
                stores: {
                    REPORTS: 'reports',
                    INSPECTIONS: 'inspections',
                    PHOTOS: 'photos',
                    SETTINGS: 'settings'
                }
            },
            config: {
                modelsDatabase: {
                    "Honda": ["CBF600", "CBF1000", "CBR650R", "Africa Twin", "CBR600F4i", "CB600"],
                    "Yamaha": ["MT-07", "MT-09", "YZF-R1", "MT-09 Tracer"],
                    "Kawasaki": ["Ninja ZX-10R", "Ninja 650", "Z900", "Versys 650", "ER6"],
                    "Suzuki": ["GSX-R1000", "GSX-S1000", "V-Strom 650", "Hayabusa", "SV650"],
                    "BMW": ["S1000RR", "R1250GS", "F900R", "G310R", "K1600GT"],
                    "KTM": ["1290 Super Duke R", "790 Duke", "390 Duke"],
                    "Ducati": ["Panigale V4", "Monster", "Scrambler", "Multistrada", "Diavel"],
                    "Triumph": ["Street Triple", "Tiger 900", "Bonneville", "Rocket 3", "Trident"],
                    "Harley-Davidson": ["Street Glide", "Sportster", "Fat Boy"],
                    "–î—Ä—É–≥–∞—è –º–∞—Ä–∫–∞": ["–î—Ä—É–≥–∞—è –º–æ–¥–µ–ª—å"]
                }
            },
            state: {
                reportsDatabase: [],
                inspectionsDatabase: [],
                deferredPrompt: null,
                notificationTimeouts: [],
                editingReportId: null,
                activeToasts: new Set(),
                audioContext: null,
                soundEnabled: true,
                audioContextInitialized: false,
                isIOS: /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream,
                currentPhotos: {},
                pdfGenerationInProgress: false,
                pdfGenerationCanceled: false
            },
            async init() {
                try {
                    await this.initIndexedDB();
                    await this.migrateFromLocalStorage();
                    await this.loadDataFromIndexedDB();
                    
                    this.initBasicComponents();
                    
                    if ('serviceWorker' in navigator) {
                        navigator.serviceWorker.register('data:text/javascript,' + encodeURIComponent(`
                            const CACHE_NAME = 'motodiag-v2.7.1';
                            const urlsToCache = ['/', '/index.html'];
                            self.addEventListener('install', event => {
                                event.waitUntil(caches.open(CACHE_NAME).then(cache => cache.addAll(urlsToCache)));
                            });
                            self.addEventListener('fetch', event => {
                                event.respondWith(caches.match(event.request).then(response => response || fetch(event.request)));
                            });
                        `)).catch(() => console.log('SW registration failed'));
                    }
                    
                    const versionDateEl = document.getElementById('appVersionDate');
                    if (versionDateEl) versionDateEl.textContent = new Date().getFullYear();
                    
                    this.checkInspectionReminders();
                    console.log('Motopodbor.ru PRO –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å IndexedDB');
                } catch (error) {
                    console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                    this.showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.', 'warning');
                    this.initBasicComponents();
                }
            },
            async initIndexedDB() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.indexedDB.name, this.indexedDB.version);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = (event) => {
                        this.db = event.target.result;
                        
                        this.db.onversionchange = () => {
                            this.db.close();
                            console.log('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç–∞—Ä–µ–ª–∞, —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã');
                            this.showToast('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 'info');
                        };
                        
                        resolve();
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        const oldVersion = event.oldVersion;
                        
                        // –°–æ–∑–¥–∞–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
                        this.createStores(db);
                        
                        // –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π
                        if (oldVersion < 2) {
                            this.upgradeToVersion2(db);
                        }
                        
                        if (oldVersion < 3) {
                            this.upgradeToVersion3(db);
                        }
                    };
                });
            },
            createStores(db) {
                if (!db.objectStoreNames.contains(this.indexedDB.stores.REPORTS)) {
                    const reportsStore = db.createObjectStore(this.indexedDB.stores.REPORTS, { 
                        keyPath: 'id' 
                    });
                    reportsStore.createIndex('timestamp', 'timestamp', { unique: false });
                    reportsStore.createIndex('brand', 'brand', { unique: false });
                }
                
                if (!db.objectStoreNames.contains(this.indexedDB.stores.INSPECTIONS)) {
                    const inspectionsStore = db.createObjectStore(this.indexedDB.stores.INSPECTIONS, { 
                        keyPath: 'id' 
                    });
                    inspectionsStore.createIndex('timestamp', 'timestamp', { unique: false });
                    inspectionsStore.createIndex('date', 'date', { unique: false });
                    inspectionsStore.createIndex('status', 'status', { unique: false });
                    inspectionsStore.createIndex('reportId', 'reportId', { unique: false });
                } else {
                    // –ï—Å–ª–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ —Å–æ–∑–¥–∞–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã
                    const inspectionsStore = db.transaction([this.indexedDB.stores.INSPECTIONS], 'readwrite')
                                              .objectStore(this.indexedDB.stores.INSPECTIONS);
                    if (!inspectionsStore.indexNames.contains('reportId')) {
                        inspectionsStore.createIndex('reportId', 'reportId', { unique: false });
                    }
                }
                
                if (!db.objectStoreNames.contains(this.indexedDB.stores.PHOTOS)) {
                    const photosStore = db.createObjectStore(this.indexedDB.stores.PHOTOS, { 
                        keyPath: 'id',
                        autoIncrement: true 
                    });
                    photosStore.createIndex('reportId', 'reportId', { unique: false });
                    photosStore.createIndex('section', 'section', { unique: false });
                } else {
                    // –ï—Å–ª–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ —Å–æ–∑–¥–∞–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã
                    const photosStore = db.transaction([this.indexedDB.stores.PHOTOS], 'readwrite')
                                         .objectStore(this.indexedDB.stores.PHOTOS);
                    if (!photosStore.indexNames.contains('reportId')) {
                        photosStore.createIndex('reportId', 'reportId', { unique: false });
                    }
                }
                
                if (!db.objectStoreNames.contains(this.indexedDB.stores.SETTINGS)) {
                    db.createObjectStore(this.indexedDB.stores.SETTINGS, { 
                        keyPath: 'key' 
                    });
                }
            },
            upgradeToVersion2(db) {
                console.log('–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–æ –≤–µ—Ä—Å–∏–∏ 2');
                // –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ createStores
            },
            upgradeToVersion3(db) {
                console.log('–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–æ –≤–µ—Ä—Å–∏–∏ 3');
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            },
            async checkIfAnyIndexedDBHasData() {
                return new Promise((resolve, reject) => {
                    if (!this.db) {
                        resolve(false);
                        return;
                    }
                    
                    const stores = [
                        this.indexedDB.stores.REPORTS,
                        this.indexedDB.stores.INSPECTIONS,
                        this.indexedDB.stores.PHOTOS
                    ];
                    
                    let completedChecks = 0;
                    let hasData = false;
                    
                    stores.forEach(storeName => {
                        try {
                            const transaction = this.db.transaction([storeName], 'readonly');
                            const store = transaction.objectStore(storeName);
                            const request = store.count();
                            
                            request.onsuccess = () => {
                                if (request.result > 0) {
                                    hasData = true;
                                }
                                completedChecks++;
                                if (completedChecks === stores.length) {
                                    resolve(hasData);
                                }
                            };
                            
                            request.onerror = () => {
                                console.error(`–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ ${storeName}:`, request.error);
                                completedChecks++;
                                if (completedChecks === stores.length) {
                                    resolve(hasData);
                                }
                            };
                        } catch (e) {
                            console.error(`–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É ${storeName}:`, e);
                            completedChecks++;
                            if (completedChecks === stores.length) {
                                resolve(hasData);
                            }
                        }
                    });
                });
            },
            async migrateFromLocalStorage() {
                try {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏
                    const migrationVersion = localStorage.getItem('motodiag_migration_version');
                    if (migrationVersion === '2.7.1') {
                        console.log('–ú–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –¥–ª—è —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏');
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
                    const hasData = await this.checkIfAnyIndexedDBHasData();
                    
                    if (hasData) {
                        console.log('IndexedDB —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏—é');
                        localStorage.setItem('motodiag_migration_version', '2.7.1');
                        return;
                    }
                    
                    let totalMigrated = 0;
                    let totalErrors = 0;
                    
                    // –ú–∏–≥—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤
                    const localStorageReports = localStorage.getItem('motodiag_reports');
                    if (localStorageReports) {
                        try {
                            const reports = JSON.parse(localStorageReports);
                            let migratedCount = 0;
                            let errorCount = 0;
                            
                            for (const report of reports) {
                                try {
                                    await this.saveReportToIndexedDB(report);
                                    migratedCount++;
                                } catch (e) {
                                    console.error('–û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞:', report.id, e);
                                    errorCount++;
                                }
                            }
                            
                            totalMigrated += migratedCount;
                            totalErrors += errorCount;
                            
                            // –£–¥–∞–ª—è–µ–º –∏–∑ localStorage —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö –æ—Ç—á–µ—Ç–æ–≤
                            if (errorCount === 0) {
                                localStorage.removeItem('motodiag_reports');
                                console.log(`–ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –æ—Ç—á–µ—Ç–æ–≤: ${migratedCount}`);
                            } else {
                                console.log(`–ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –æ—Ç—á–µ—Ç–æ–≤: ${migratedCount}, –æ—à–∏–±–æ–∫: ${errorCount}`);
                            }
                        } catch (e) {
                            console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç—á–µ—Ç–æ–≤ –∏–∑ localStorage:', e);
                            totalErrors++;
                        }
                    }
                    
                    // –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫
                    const localStorageInspections = localStorage.getItem('motodiag_inspections');
                    if (localStorageInspections) {
                        try {
                            const inspections = JSON.parse(localStorageInspections);
                            let migratedCount = 0;
                            let errorCount = 0;
                            
                            for (const inspection of inspections) {
                                try {
                                    await this.saveInspectionToIndexedDB(inspection);
                                    migratedCount++;
                                } catch (e) {
                                    console.error('–û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:', inspection.id, e);
                                    errorCount++;
                                }
                            }
                            
                            totalMigrated += migratedCount;
                            totalErrors += errorCount;
                            
                            if (errorCount === 0) {
                                localStorage.removeItem('motodiag_inspections');
                                console.log(`–ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–æ–≤–µ—Ä–æ–∫: ${migratedCount}`);
                            } else {
                                console.log(`–ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–æ–≤–µ—Ä–æ–∫: ${migratedCount}, –æ—à–∏–±–æ–∫: ${errorCount}`);
                            }
                        } catch (e) {
                            console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏–∑ localStorage:', e);
                            totalErrors++;
                        }
                    }
                    
                    // –ú–∏–≥—Ä–∞—Ü–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
                    const localStoragePhotos = localStorage.getItem('motodiag_current_photos');
                    if (localStoragePhotos) {
                        try {
                            this.state.currentPhotos = JSON.parse(localStoragePhotos);
                            localStorage.removeItem('motodiag_current_photos');
                            console.log('–ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Ç–µ–∫—É—â–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏');
                        } catch (e) {
                            console.error('–û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π:', e);
                            totalErrors++;
                        }
                    }
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–µ—Ä—Å–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±—ã–ª–∏ —É—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ
                    if (totalMigrated > 0 || totalErrors === 0) {
                        localStorage.setItem('motodiag_migration_version', '2.7.1');
                        console.log(`–ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –£—Å–ø–µ—à–Ω–æ: ${totalMigrated}, –æ—à–∏–±–æ–∫: ${totalErrors}`);
                    }
                    
                } catch (e) {
                    console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
                    this.showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.', 'warning');
                }
            },
            async getReportFromIndexedDB(reportId) {
                return new Promise((resolve, reject) => {
                    if (!this.db) {
                        resolve(null);
                        return;
                    }
                    
                    const transaction = this.db.transaction([this.indexedDB.stores.REPORTS], 'readonly');
                    const store = transaction.objectStore(this.indexedDB.stores.REPORTS);
                    const request = store.get(reportId);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },
            async getInspectionFromIndexedDB(inspectionId) {
                return new Promise((resolve, reject) => {
                    if (!this.db) {
                        resolve(null);
                        return;
                    }
                    
                    const transaction = this.db.transaction([this.indexedDB.stores.INSPECTIONS], 'readonly');
                    const store = transaction.objectStore(this.indexedDB.stores.INSPECTIONS);
                    const request = store.get(inspectionId);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },
            async loadDataFromIndexedDB() {
                return new Promise((resolve, reject) => {
                    if (!this.db) {
                        reject(new Error('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞'));
                        return;
                    }
                    
                    const transaction = this.db.transaction([
                        this.indexedDB.stores.REPORTS, 
                        this.indexedDB.stores.INSPECTIONS
                    ], 'readonly');
                    
                    let reportsLoaded = false;
                    let inspectionsLoaded = false;
                    let hasError = false;
                    
                    const checkCompletion = () => {
                        if (reportsLoaded && inspectionsLoaded && !hasError) {
                            console.log('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ IndexedDB:', {
                                reports: this.state.reportsDatabase.length,
                                inspections: this.state.inspectionsDatabase.length
                            });
                            resolve();
                        }
                    };
                    
                    transaction.onerror = (event) => {
                        hasError = true;
                        reject(new Error(`Transaction error: ${event.target.error}`));
                    };
                    
                    const reportsRequest = transaction.objectStore(this.indexedDB.stores.REPORTS).getAll();
                    reportsRequest.onsuccess = () => {
                        this.state.reportsDatabase = reportsRequest.result || [];
                        reportsLoaded = true;
                        checkCompletion();
                    };
                    reportsRequest.onerror = () => {
                        hasError = true;
                        reject(new Error('Failed to load reports'));
                    };
                    
                    const inspectionsRequest = transaction.objectStore(this.indexedDB.stores.INSPECTIONS).getAll();
                    inspectionsRequest.onsuccess = () => {
                        this.state.inspectionsDatabase = inspectionsRequest.result || [];
                        inspectionsLoaded = true;
                        checkCompletion();
                    };
                    inspectionsRequest.onerror = () => {
                        hasError = true;
                        reject(new Error('Failed to load inspections'));
                    };
                });
            },
            async saveReportToIndexedDB(report) {
                return new Promise((resolve, reject) => {
                    if (!this.db) {
                        reject(new Error('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞'));
                        return;
                    }
                    
                    const transaction = this.db.transaction([this.indexedDB.stores.REPORTS], 'readwrite');
                    const store = transaction.objectStore(this.indexedDB.stores.REPORTS);
                    
                    const request = store.put(report);
                    
                    request.onsuccess = () => {
                        console.log('–û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ IndexedDB:', report.id);
                        resolve();
                    };
                    request.onerror = () => {
                        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞:', request.error);
                        reject(request.error);
                    };
                });
            },
            async saveInspectionToIndexedDB(inspection) {
                return new Promise((resolve, reject) => {
                    if (!this.db) {
                        reject(new Error('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞'));
                        return;
                    }
                    
                    const transaction = this.db.transaction([this.indexedDB.stores.INSPECTIONS], 'readwrite');
                    const store = transaction.objectStore(this.indexedDB.stores.INSPECTIONS);
                    
                    const request = store.put(inspection);
                    
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            },
            async savePhotosToIndexedDB(reportId, photos) {
                if (!this.db || !photos || Object.keys(photos).length === 0) {
                    return Promise.resolve();
                }
                
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction([this.indexedDB.stores.PHOTOS], 'readwrite');
                    const store = transaction.objectStore(this.indexedDB.stores.PHOTOS);
                    
                    transaction.oncomplete = () => {
                        console.log('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ IndexedDB');
                        resolve();
                    };
                    
                    transaction.onerror = () => {
                        console.error('–û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ñ–æ—Ç–æ:', transaction.error);
                        reject(transaction.error);
                    };
                    
                    try {
                        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Ñ–æ—Ç–æ –¥–ª—è —ç—Ç–æ–≥–æ –æ—Ç—á–µ—Ç–∞
                        const index = store.index('reportId');
                        const clearRequest = index.openCursor(IDBKeyRange.only(reportId));
                        
                        clearRequest.onsuccess = () => {
                            const cursor = clearRequest.result;
                            if (cursor) {
                                store.delete(cursor.primaryKey);
                                cursor.continue();
                            } else {
                                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–µ —Ñ–æ—Ç–æ
                                this.saveNewPhotos(store, reportId, photos);
                                resolve();
                            }
                        };
                        
                        clearRequest.onerror = () => reject(clearRequest.error);
                        
                    } catch (error) {
                        reject(error);
                    }
                });
            },
            saveNewPhotos(store, reportId, photos) {
                let photosCount = 0;
                let savedCount = 0;
                
                Object.keys(photos).forEach(section => {
                    photosCount += photos[section].length;
                });
                
                if (photosCount === 0) {
                    return;
                }
                
                Object.keys(photos).forEach(section => {
                    photos[section].forEach(photo => {
                        const photoRecord = {
                            reportId: reportId,
                            section: section,
                            data: photo.data,
                            name: photo.name,
                            timestamp: photo.timestamp,
                            compressed: photo.compressed
                        };
                        
                        const request = store.add(photoRecord);
                        request.onsuccess = () => {
                            savedCount++;
                            if (savedCount === photosCount) {
                                console.log(`–í—Å–µ ${savedCount} —Ñ–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ`);
                            }
                        };
                        request.onerror = (event) => {
                            console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ç–æ:', event.target.error);
                        };
                    });
                });
            },
            async loadPhotosFromIndexedDB(reportId) {
                return new Promise((resolve, reject) => {
                    if (!this.db) {
                        resolve({});
                        return;
                    }
                    
                    const transaction = this.db.transaction([this.indexedDB.stores.PHOTOS], 'readonly');
                    const store = transaction.objectStore(this.indexedDB.stores.PHOTOS);
                    const index = store.index('reportId');
                    const request = index.getAll(IDBKeyRange.only(reportId));
                    
                    request.onsuccess = () => {
                        const photos = {};
                        request.result.forEach(photoRecord => {
                            if (!photos[photoRecord.section]) {
                                photos[photoRecord.section] = [];
                            }
                            photos[photoRecord.section].push({
                                id: photoRecord.id,
                                data: photoRecord.data,
                                name: photoRecord.name,
                                timestamp: photoRecord.timestamp,
                                compressed: photoRecord.compressed
                            });
                        });
                        resolve(photos);
                    };
                    
                    request.onerror = () => {
                        reject(request.error);
                    };
                });
            },
            async deleteReportFromIndexedDB(reportId) {
                return new Promise((resolve, reject) => {
                    if (!this.db) {
                        reject(new Error('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞'));
                        return;
                    }
                    
                    const transaction = this.db.transaction([
                        this.indexedDB.stores.REPORTS,
                        this.indexedDB.stores.INSPECTIONS,
                        this.indexedDB.stores.PHOTOS
                    ], 'readwrite');
                    
                    let completedOperations = 0;
                    const totalOperations = 3;
                    let hasError = false;
                    
                    const checkCompletion = () => {
                        if (completedOperations === totalOperations && !hasError) {
                            console.log(`–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —É–¥–∞–ª–µ–Ω–∏—è –¥–ª—è –æ—Ç—á–µ—Ç–∞ ${reportId} –∑–∞–≤–µ—Ä—à–µ–Ω—ã`);
                            resolve();
                        }
                    };
                    
                    transaction.onerror = (event) => {
                        hasError = true;
                        console.error('–û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —É–¥–∞–ª–µ–Ω–∏—è:', event.target.error);
                        reject(event.target.error);
                    };
                    
                    // –£–¥–∞–ª—è–µ–º –æ—Ç—á–µ—Ç
                    const reportsStore = transaction.objectStore(this.indexedDB.stores.REPORTS);
                    const reportRequest = reportsStore.delete(reportId);
                    reportRequest.onsuccess = () => {
                        console.log('–û—Ç—á–µ—Ç —É–¥–∞–ª–µ–Ω –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ reports');
                        completedOperations++;
                        checkCompletion();
                    };
                    reportRequest.onerror = () => {
                        hasError = true;
                        reject(reportRequest.error);
                    };
                    
                    // –£–¥–∞–ª—è–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞)
                    const inspectionsStore = transaction.objectStore(this.indexedDB.stores.INSPECTIONS);
                    const inspectionsRequest = inspectionsStore.openCursor();
                    
                    let inspectionsDeleted = false;
                    inspectionsRequest.onsuccess = () => {
                        const cursor = inspectionsRequest.result;
                        if (cursor) {
                            if (cursor.value.reportId === reportId) {
                                inspectionsStore.delete(cursor.primaryKey);
                            }
                            cursor.continue();
                        } else {
                            console.log('–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã');
                            inspectionsDeleted = true;
                            completedOperations++;
                            checkCompletion();
                        }
                    };
                    inspectionsRequest.onerror = () => {
                        hasError = true;
                        reject(inspectionsRequest.error);
                    };
                    
                    // –£–¥–∞–ª—è–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ (–±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞)
                    const photosStore = transaction.objectStore(this.indexedDB.stores.PHOTOS);
                    const photosRequest = photosStore.openCursor();
                    
                    let photosDeleted = false;
                    photosRequest.onsuccess = () => {
                        const cursor = photosRequest.result;
                        if (cursor) {
                            if (cursor.value.reportId === reportId) {
                                photosStore.delete(cursor.primaryKey);
                            }
                            cursor.continue();
                        } else {
                            console.log('–í—Å–µ —Ñ–æ—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã');
                            photosDeleted = true;
                            completedOperations++;
                            checkCompletion();
                        }
                    };
                    photosRequest.onerror = () => {
                        hasError = true;
                        reject(photosRequest.error);
                    };
                    
                    // –ù–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
                    setTimeout(() => {
                        if (!inspectionsDeleted) {
                            console.log('–ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                            completedOperations++;
                            checkCompletion();
                        }
                        if (!photosDeleted) {
                            console.log('–ù–µ—Ç —Ñ–æ—Ç–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                            completedOperations++;
                            checkCompletion();
                        }
                    }, 100);
                });
            },
            async saveReportToDatabase() {
                if (!this.validateForm()) return;
                
                try {
                    const form = document.getElementById('diagnosticForm');
                    const formData = new FormData(form);
                    const data = Object.fromEntries(formData.entries());
                    const brand = data.brand === '–î—Ä—É–≥–∞—è –º–∞—Ä–∫–∞' ? data.brand_custom : data.brand;
                    const model = data.model === '–î—Ä—É–≥–∞—è –º–æ–¥–µ–ª—å' ? data.model_custom : data.model;
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏ —Ñ–æ—Ç–æ
                    const report = {
                        id: this.state.editingReportId || Date.now().toString(),
                        timestamp: new Date().toISOString(),
                        brand,
                        model,
                        year: data.year,
                        mileage_km: data.mileage_km,
                        mileage_miles: data.mileage_miles,
                        vin: data.vin,
                        engine_number: data.engine_number,
                        license_plate: data.license_plate,
                        motorcycle_class: data.motorcycle_class,
                        gearbox_type: data.gearbox_type,
                        origin_country: data.origin_country,
                        auction_type: data.auction_type,
                        auction_lot_number: data.auction_lot_number,
                        legal_check: data.legal_check,
                        pts_type: data.pts_type,
                        legal_status: data.legal_status,
                        price: data.price,
                        objective_cost: data.objective_cost,
                        seller_discount: data.seller_discount,
                        investment_cost: data.investment_cost,
                        key_finding: data.key_finding,
                        expert_verdict: data.expert_verdict,
                        decision: data.decision,
                        generated_text: document.getElementById('output')?.textContent || ''
                    };
                    
                    console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –≤ –±–∞–∑—É:', report);
                    
                    await this.saveReportToIndexedDB(report);
                    
                    // –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–æ—Ç–æ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
                    // if (Object.keys(this.state.currentPhotos).length > 0) {
                    //     await this.savePhotosToIndexedDB(report.id, this.state.currentPhotos);
                    // }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                    const existingIndex = this.state.reportsDatabase.findIndex(r => r.id === report.id);
                    if (existingIndex >= 0) {
                        this.state.reportsDatabase[existingIndex] = report;
                    } else {
                        this.state.reportsDatabase.push(report);
                    }
                    
                    if (data.decision === 'üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É') {
                        await this.saveInspectionToDatabase(data, report.id);
                    }
                    
                    this.playSound('success');
                    this.showToast('–û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!', 'success');
                    this.loadReportsList();
                    this.updateStatistics();
                    this.state.editingReportId = null;
                    
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞:', e);
                    this.playSound('error');
                    this.showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ—Ç—á–µ—Ç–∞', 'warning');
                }
            },
            async deleteReport(reportId) {
                if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç—á–µ—Ç?')) return;
                
                try {
                    await this.deleteReportFromIndexedDB(reportId);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                    this.state.reportsDatabase = this.state.reportsDatabase.filter(r => r.id !== reportId);
                    this.state.inspectionsDatabase = this.state.inspectionsDatabase.filter(i => i.reportId !== reportId);
                    
                    // –ï—Å–ª–∏ —É–¥–∞–ª—è–µ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π –æ—Ç—á–µ—Ç, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                    if (this.state.editingReportId === reportId) {
                        this.state.editingReportId = null;
                        this.state.currentPhotos = {};
                        this.clearForm();
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º UI
                    this.loadReportsList();
                    this.loadInspectionsList();
                    this.updateStatistics();
                    
                    this.playSound('success');
                    this.showToast('–û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω', 'success');
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞:', e);
                    this.playSound('error');
                    this.showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ç—á–µ—Ç–∞', 'warning');
                }
            },
            async editReport(reportId) {
                try {
                    const report = this.state.reportsDatabase.find(r => r.id === reportId);
                    if (!report) return;
                    
                    this.state.editingReportId = reportId;
                    this.state.currentPhotos = {};
                    
                    // –ù–µ –∑–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
                    // const photos = await this.loadPhotosFromIndexedDB(reportId);
                    // this.state.currentPhotos = photos;
                    
                    Object.keys(report).forEach(key => {
                        const el = document.getElementById(key);
                        if (el && report[key] !== undefined && report[key] !== null) {
                            el.value = report[key];
                        }
                    });
                    
                    this.loadPhotoPreviews();
                    
                    const brandSelect = document.getElementById('brand');
                    if (brandSelect && report.brand) {
                        brandSelect.value = report.brand;
                        brandSelect.dispatchEvent(new Event('change'));
                        setTimeout(() => {
                            const modelSelect = document.getElementById('model');
                            if (modelSelect && report.model) {
                                modelSelect.value = report.model;
                                modelSelect.dispatchEvent(new Event('change'));
                            }
                        }, 0);
                    }
                    
                    this.updateUIForEditMode(report);
                    this.updateProgress();
                    
                    const reportTab = document.querySelector('.nav-tab[data-tab="report"]');
                    if (reportTab) reportTab.click();
                    
                    this.playSound('click');
                    this.showToast(`–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞: ${report.brand} ${report.model}`, 'info');
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç—á–µ—Ç–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:', e);
                    this.playSound('error');
                    this.showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Ç—á–µ—Ç–∞', 'warning');
                }
            },
            updateUIForEditMode(report) {
                const brandCustom = document.getElementById('brand_custom');
                const modelCustom = document.getElementById('model_custom');
                const inspectionFields = document.getElementById('inspectionFields');
                const auctionLotGroup = document.getElementById('auctionLotNumberGroup');
                
                if (brandCustom) brandCustom.classList.toggle('hidden', report.brand !== '–î—Ä—É–≥–∞—è –º–∞—Ä–∫–∞');
                if (modelCustom) modelCustom.classList.toggle('hidden', report.model !== '–î—Ä—É–≥–∞—è –º–æ–¥–µ–ª—å');
                if (inspectionFields) inspectionFields.classList.toggle('hidden', report.decision !== 'üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É');
                if (auctionLotGroup && report.auction_type) {
                    this.toggleAuctionLotField(report.auction_type);
                }
            },
            initBasicComponents() {
                this.initNavigation();
                this.initTheme();
                this.initForm();
                this.initScrollToTop();
                this.initModal();
                this.initTooltips();
                this.initInspectionsButtons();
                this.initSoundSystem();
                this.initClearStorage();
                this.initAllDataButtons();
                this.initPhotoUploadSystem();
                this.initHeaderScrollEffect();
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
                const interactiveElements = document.querySelectorAll('button, input, select, textarea, .nav-tab, .card');
                interactiveElements.forEach(element => {
                    element.addEventListener('click', () => {
                        // –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ –Ω–∞ –ª—é–±–æ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–≤—É–∫
                        if (!this.state.audioContext) {
                            this.setupAudioContextOnUserGesture();
                        }
                    });
                });
            },
            initHeaderScrollEffect() {
                const header = document.querySelector('.app-header');
                if (!header) return;
                
                let lastScrollY = window.scrollY;
                let ticking = false;
                
                const updateHeader = () => {
                    if (window.scrollY > 50) {
                        header.classList.add('scrolled');
                    } else {
                        header.classList.remove('scrolled');
                    }
                    lastScrollY = window.scrollY;
                    ticking = false;
                };
                
                const onScroll = () => {
                    if (!ticking) {
                        requestAnimationFrame(updateHeader);
                        ticking = true;
                    }
                };
                
                window.addEventListener('scroll', onScroll, { passive: true });
            },
            initPhotoUploadSystem() {
                this.loadPhotoPreviews();
                const photoInputs = document.querySelectorAll('.photo-upload-input');
                photoInputs.forEach(input => {
                    input.addEventListener('change', (e) => {
                        const section = e.target.getAttribute('data-section');
                        this.handlePhotoUpload(section, e.target.files);
                        e.target.value = '';
                    });
                });
                console.log('–°–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
            },
            handlePhotoUpload(section, files) {
                if (!files || files.length === 0) return;
                
                if (!this.state.currentPhotos[section]) {
                    this.state.currentPhotos[section] = [];
                }
                
                const maxPhotos = (section === 'exterior') ? 1 : 9;
                const currentCount = this.state.currentPhotos[section].length;
                const remainingSlots = maxPhotos - currentCount;
                
                if (remainingSlots <= 0) {
                    this.showToast(`–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –≤ ${maxPhotos} —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –¥–ª—è —ç—Ç–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞`, 'warning');
                    return;
                }
                
                const filesToProcess = Array.from(files).slice(0, remainingSlots);
                let processedCount = 0;
                
                filesToProcess.forEach(file => {
                    if (file.type.startsWith('image/')) {
                        this.compressImage(file).then(compressedFile => {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const base64Data = e.target.result;
                                this.state.currentPhotos[section].push({
                                    id: Date.now() + Math.random(),
                                    data: base64Data,
                                    name: file.name,
                                    timestamp: new Date().toISOString(),
                                    compressed: true
                                });
                                
                                processedCount++;
                                if (processedCount === filesToProcess.length) {
                                    this.updatePhotoPreview(section);
                                    this.updatePhotoCounter(section);
                                    this.playSound('success');
                                    this.showToast(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${processedCount} —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ —Ä–∞–∑–¥–µ–ª "${this.getSectionName(section)}"`, 'success');
                                }
                            };
                            reader.readAsDataURL(compressedFile);
                        }).catch(error => {
                            console.error('–û—à–∏–±–∫–∞ —Å–∂–∞—Ç–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', error);
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const base64Data = e.target.result;
                                this.state.currentPhotos[section].push({
                                    id: Date.now() + Math.random(),
                                    data: base64Data,
                                    name: file.name,
                                    timestamp: new Date().toISOString(),
                                    compressed: false
                                });
                                
                                processedCount++;
                                if (processedCount === filesToProcess.length) {
                                    this.updatePhotoPreview(section);
                                    this.updatePhotoCounter(section);
                                    this.playSound('success');
                                    this.showToast(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${processedCount} —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ —Ä–∞–∑–¥–µ–ª "${this.getSectionName(section)}"`, 'success');
                                }
                            };
                            reader.readAsDataURL(file);
                        });
                    }
                });
            },
            compressImage(file, maxWidth = 800, quality = 0.6) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            let width = img.width;
                            let height = img.height;
                            if (width > maxWidth) {
                                height = Math.round((height * maxWidth) / width);
                                width = maxWidth;
                            }
                            canvas.width = width;
                            canvas.height = height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, width, height);
                            canvas.toBlob((blob) => {
                                resolve(blob);
                            }, 'image/jpeg', quality);
                        };
                        img.onerror = reject;
                        img.src = e.target.result;
                    };
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            },
            getSectionName(section) {
                const sectionNames = {
                    'exterior': '–¢–∏—Ç—É–ª—å–Ω—ã–π –ª–∏—Å—Ç',
                    'geometry': '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏',
                    'engine': '–û—Å–º–æ—Ç—Ä –û–±—â–∏–π, –í–Ω–µ—à–Ω–∏–π –≤–∏–¥',
                    'consumables': '–°–æ—Å—Ç–æ—è–Ω–∏–µ –õ–ö–ü',
                    'electrical': '–°–æ—Å—Ç–æ—è–Ω–∏–µ –°–∏–¥–µ–Ω—å—è',
                    'suspension': '–û—Å–º–æ—Ç—Ä –û–ø—Ç–∏–∫–∏',
                    'fuel_system': '–†–∞–º–∞, –®–≤—ã, –í—Ç–æ—Ä–∏—á–Ω–∞—è –æ–∫—Ä–∞—Å–∫–∞',
                    'brake_system': '–ö—Ä–∏–º–∏–Ω–∞–ª, –í–∏–Ω –Ω–æ–º–µ—Ä–∞, –ù–æ–º–µ—Ä–∞ –î–≤–∏–≥–∞—Ç–µ–ª—è',
                    'cooling_system': '–ì–µ–æ–º–µ—Ç—Ä–∏—è, –ü–æ–¥—Ä–∞–º–Ω–∏–∫–∞, —Ä—É–ª—è, –≤–∏–ª–∫–∏',
                    'controls': '–û—Ä–≥–∞–Ω—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è',
                    'additional_equipment': '–ú–æ—Ç–æ—Ä–Ω—ã–π –£–∑–µ–ª',
                    'bodywork': '–¢–æ–ø–ª–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞',
                    'electrical_new': '–°–∏—Å—Ç–µ–º–∞ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è',
                    'brake_system_new': '–≠–ª–µ–∫—Ç—Ä–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ',
                    'drive': '–¢–æ—Ä–º–æ–∑–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞',
                    'tires': '–ü—Ä–∏–≤–æ–¥',
                    'suspension_front_rear': '–†–µ–∑–∏–Ω–∞',
                    'computer_diagnostics': '–ü–æ–¥–≤–µ—Å–∫–∞ –ø–µ—Ä–µ–¥, –∑–∞–¥',
                    'additional_equipment_new': '–ö–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞',
                    'final': '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ'
                };
                return sectionNames[section] || section;
            },
            updatePhotoPreview(section) {
                const previewContainer = document.querySelector(`.photo-preview-container[data-section="${section}"]`);
                if (!previewContainer) {
                    console.warn(`–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–µ–∫—Ü–∏–∏ ${section} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                    return;
                }
                const photos = this.state.currentPhotos[section] || [];
                previewContainer.innerHTML = photos.map(photo => `
                    <div class="photo-preview-item">
                        <img src="${photo.data}" alt="${photo.name}" class="photo-preview-img">
                        <button class="photo-preview-remove" onclick="app.removePhoto('${section}', ${photo.id})">√ó</button>
                    </div>
                `).join('');
            },
            updatePhotoCounter(section) {
                const counter = document.querySelector(`.photo-counter[data-section="${section}"]`);
                if (counter) {
                    const photos = this.state.currentPhotos[section] || [];
                    const maxPhotos = (section === 'exterior') ? 1 : 9;
                    counter.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ: ${photos.length}/${maxPhotos}`;
                    if (photos.length >= maxPhotos) {
                        counter.style.color = 'var(--warning-color)';
                        counter.style.fontWeight = '600';
                    } else {
                        counter.style.color = 'var(--text-light)';
                        counter.style.fontWeight = 'normal';
                    }
                }
            },
            removePhoto(section, photoId) {
                if (!this.state.currentPhotos[section]) return;
                const idToRemove = typeof photoId === 'string' ? parseFloat(photoId) : photoId;
                this.state.currentPhotos[section] = this.state.currentPhotos[section].filter(photo => {
                    const photoIdNum = typeof photo.id === 'string' ? parseFloat(photo.id) : photo.id;
                    return photoIdNum !== idToRemove;
                });
                this.updatePhotoPreview(section);
                this.updatePhotoCounter(section);
                this.playSound('success');
                this.showToast('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —É–¥–∞–ª–µ–Ω–∞', 'success');
            },
            loadPhotoPreviews() {
                Object.keys(this.state.currentPhotos).forEach(section => {
                    this.updatePhotoPreview(section);
                    this.updatePhotoCounter(section);
                });
            },
            clearAllPhotos() {
                this.state.currentPhotos = {};
                const previewContainers = document.querySelectorAll('.photo-preview-container');
                previewContainers.forEach(container => {
                    container.innerHTML = '';
                });
                const counters = document.querySelectorAll('.photo-counter');
                counters.forEach(counter => {
                    const section = counter.getAttribute('data-section');
                    const maxPhotos = (section === 'exterior') ? 1 : 9;
                    counter.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ: 0/${maxPhotos}`;
                    counter.style.color = 'var(--text-light)';
                    counter.style.fontWeight = 'normal';
                });
            },
            initSoundSystem() {
                try {
                    // –¢–æ–ª—å–∫–æ –∑–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –Ω–µ —Å–æ–∑–¥–∞–µ–º –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å—Ä–∞–∑—É
                    const soundEnabled = localStorage.getItem('motodiag_sound_enabled');
                    this.state.soundEnabled = soundEnabled === null ? true : soundEnabled === 'true';
                    const soundCheckbox = document.getElementById('soundNotifications');
                    if (soundCheckbox) {
                        soundCheckbox.checked = this.state.soundEnabled;
                    }
                    
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏
                    this.setupAudioContextOnUserGesture();
                    console.log('–ó–≤—É–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ (–æ–∂–∏–¥–∞–Ω–∏–µ –∂–µ—Å—Ç–∞ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏)');
                } catch (e) {
                    console.warn('–ê—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è:', e);
                    this.state.soundEnabled = false;
                }
            },
            setupAudioContextOnUserGesture() {
                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏
                const initAudioContext = () => {
                    try {
                        if (!this.state.audioContext) {
                            this.state.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                            console.log('–ê—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–æ –∂–µ—Å—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                        }
                        
                        // –£–¥–∞–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                        document.removeEventListener('click', initAudioContext);
                        document.removeEventListener('keydown', initAudioContext);
                        document.removeEventListener('touchstart', initAudioContext);
                    } catch (e) {
                        console.warn('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:', e);
                        this.state.soundEnabled = false;
                    }
                };

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∂–µ—Å—Ç–æ–≤
                document.addEventListener('click', initAudioContext, { once: true });
                document.addEventListener('keydown', initAudioContext, { once: true });
                document.addEventListener('touchstart', initAudioContext, { once: true });
            },
            playSound(type) {
                // –ï—Å–ª–∏ –∑–≤—É–∫ –æ—Ç–∫–ª—é—á–µ–Ω, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
                if (!this.state.soundEnabled) return;
                
                try {
                    // –ï—Å–ª–∏ –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω, –ø—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –µ–≥–æ
                    if (!this.state.audioContext) {
                        this.state.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    }
                    
                    // –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–æ–±—ã—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è), –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ
                    if (this.state.audioContext.state === 'suspended') {
                        this.state.audioContext.resume();
                    }
                    
                    const oscillator = this.state.audioContext.createOscillator();
                    const gainNode = this.state.audioContext.createGain();
                    oscillator.connect(gainNode);
                    gainNode.connect(this.state.audioContext.destination);
                    
                    let frequency = 440;
                    let duration = 0.2;
                    let typeWave = 'sine';
                    
                    switch(type) {
                        case 'success':
                            frequency = 880;
                            duration = 0.3;
                            typeWave = 'sine';
                            break;
                        case 'error':
                            frequency = 220;
                            duration = 0.5;
                            typeWave = 'sawtooth';
                            break;
                        case 'notification':
                            frequency = 660;
                            duration = 0.1;
                            typeWave = 'square';
                            break;
                        case 'save':
                            frequency = 550;
                            duration = 0.2;
                            typeWave = 'sine';
                            break;
                        case 'click':
                            frequency = 500;
                            duration = 0.05;
                            typeWave = 'square';
                            break;
                        case 'completion':
                            frequency = 523.25;
                            duration = 0.8;
                            typeWave = 'sine';
                            break;
                        case 'warning':
                            frequency = 329.63;
                            duration = 0.7;
                            typeWave = 'sawtooth';
                            break;
                    }
                    
                    oscillator.frequency.value = frequency;
                    oscillator.type = typeWave;
                    gainNode.gain.setValueAtTime(0.3, this.state.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, this.state.audioContext.currentTime + duration);
                    oscillator.start(this.state.audioContext.currentTime);
                    oscillator.stop(this.state.audioContext.currentTime + duration);
                } catch (e) {
                    console.warn('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞:', e);
                    // –û—Ç–∫–ª—é—á–∞–µ–º –∑–≤—É–∫ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
                    this.state.soundEnabled = false;
                }
            },
            initNavigation() {
                const navTabs = document.querySelectorAll('.nav-tab');
                const tabContents = document.querySelectorAll('.tab-content');
                navTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const tabId = this.getAttribute('data-tab');
                        if (!tabId) return;
                        app.playSound('click');
                        navTabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        tabContents.forEach(c => {
                            c.classList.remove('active');
                            if (c.id === `${tabId}-tab`) {
                                c.classList.add('active');
                            }
                        });
                        if (tabId === 'database') {
                            app.loadReportsList();
                        }
                        if (tabId === 'inspections') {
                            app.loadInspectionsList();
                        }
                        if (tabId === 'stats') {
                            app.updateStatistics();
                        }
                    });
                });
            },
            initTheme() {
                const savedTheme = localStorage.getItem('motodiag_theme') || 'light';
                document.body.setAttribute('data-theme', savedTheme);
                const darkThemeCheckbox = document.getElementById('darkTheme');
                if (darkThemeCheckbox) {
                    darkThemeCheckbox.checked = savedTheme === 'dark';
                    darkThemeCheckbox.addEventListener('change', this.toggleTheme);
                }
                const soundCheckbox = document.getElementById('soundNotifications');
                if (soundCheckbox) {
                    soundCheckbox.addEventListener('change', (e) => {
                        this.state.soundEnabled = e.target.checked;
                        localStorage.setItem('motodiag_sound_enabled', this.state.soundEnabled);
                        if (this.state.soundEnabled) {
                            this.playSound('notification');
                        }
                    });
                }
            },
            toggleTheme() {
                const isDark = document.getElementById('darkTheme').checked;
                const theme = isDark ? 'dark' : 'light';
                document.body.setAttribute('data-theme', theme);
                localStorage.setItem('motodiag_theme', theme);
                app.playSound('click');
            },
            initClearStorage() {
                const clearStorageBtn = document.getElementById('clearStorageBtn');
                if (clearStorageBtn) {
                    clearStorageBtn.addEventListener('click', async () => {
                        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                            try {
                                // –û—á–∏—â–∞–µ–º IndexedDB
                                if (this.db) {
                                    const stores = [
                                        this.indexedDB.stores.REPORTS,
                                        this.indexedDB.stores.INSPECTIONS,
                                        this.indexedDB.stores.PHOTOS,
                                        this.indexedDB.stores.SETTINGS
                                    ];
                                    
                                    // –û—á–∏—â–∞–µ–º –∫–∞–∂–¥–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
                                    for (const storeName of stores) {
                                        await new Promise((resolve, reject) => {
                                            const transaction = this.db.transaction([storeName], 'readwrite');
                                            const store = transaction.objectStore(storeName);
                                            const request = store.clear();
                                            
                                            request.onsuccess = () => {
                                                console.log(`–•—Ä–∞–Ω–∏–ª–∏—â–µ ${storeName} –æ—á–∏—â–µ–Ω–æ`);
                                                resolve();
                                            };
                                            request.onerror = () => {
                                                console.error(`–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ ${storeName}:`, request.error);
                                                reject(request.error);
                                            };
                                        });
                                    }
                                }
                                
                                // –û—á–∏—â–∞–µ–º localStorage
                                const itemsToRemove = [
                                    'motodiag_theme',
                                    'motodiag_sound_enabled',
                                    'motodiag_auto_save',
                                    'motodiag_inspection_notifications',
                                    'motodiag_reminder_time',
                                    'motodiag_form_data'
                                ];
                                
                                itemsToRemove.forEach(item => {
                                    localStorage.removeItem(item);
                                });
                                
                                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                                this.state.reportsDatabase = [];
                                this.state.inspectionsDatabase = [];
                                this.state.currentPhotos = {};
                                this.state.editingReportId = null;
                                
                                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                                this.loadReportsList();
                                this.loadInspectionsList();
                                this.updateStatistics();
                                this.clearForm();
                                
                                this.showToast('–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã', 'success');
                                this.playSound('success');
                            } catch (e) {
                                console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
                                this.playSound('error');
                                this.showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö', 'warning');
                            }
                        }
                    });
                }
            },
            initAllDataButtons() {
                const exportAllDataBtn = document.getElementById('exportAllDataBtn');
                const importAllDataBtn = document.getElementById('importAllDataBtn');
                if (exportAllDataBtn) {
                    exportAllDataBtn.addEventListener('click', () => {
                        this.playSound('click');
                        this.exportAllData();
                    });
                }
                if (importAllDataBtn) {
                    importAllDataBtn.addEventListener('click', () => {
                        this.playSound('click');
                        this.importAllData();
                    });
                }
            },
            convertKmToMiles(km) {
                return (km * 0.621371).toFixed(1);
            },
            convertMilesToKm(miles) {
                return (miles / 0.621371).toFixed(1);
            },
            initMileageFields() {
                const mileageKm = document.getElementById('mileage_km');
                const mileageMiles = document.getElementById('mileage_miles');
                if (!mileageKm || !mileageMiles) return;
                mileageKm.addEventListener('input', () => {
                    const kmValue = parseFloat(mileageKm.value);
                    if (!isNaN(kmValue) && kmValue >= 0) {
                        const milesValue = this.convertKmToMiles(kmValue);
                        mileageMiles.value = milesValue;
                    } else {
                        mileageMiles.value = '';
                    }
                    this.updateProgress();
                });
                mileageMiles.addEventListener('input', () => {
                    const milesValue = parseFloat(mileageMiles.value);
                    if (!isNaN(milesValue) && milesValue >= 0) {
                        const kmValue = this.convertMilesToKm(milesValue);
                        mileageKm.value = kmValue;
                    } else {
                        mileageKm.value = '';
                    }
                    this.updateProgress();
                });
            },
            initForm() {
                const brandSelect = document.getElementById('brand');
                const modelSelect = document.getElementById('model');
                if (brandSelect && modelSelect) {
                    brandSelect.addEventListener('change', function() {
                        const brand = this.value;
                        const isCustomBrand = brand === '–î—Ä—É–≥–∞—è –º–∞—Ä–∫–∞';
                        const brandCustom = document.getElementById('brand_custom');
                        if (brandCustom) {
                            brandCustom.classList.toggle('hidden', !isCustomBrand);
                            if (!isCustomBrand) brandCustom.value = '';
                        }
                        
                        // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π
                        modelSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å --</option>';
                        
                        if (brand && app.config.modelsDatabase[brand]) {
                            // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–µ–ª–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–∞—Ä–∫–∏
                            app.config.modelsDatabase[brand].forEach(model => {
                                const option = document.createElement('option');
                                option.value = model;
                                option.textContent = model;
                                modelSelect.appendChild(option);
                            });
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ü–∏—é "–î—Ä—É–≥–∞—è –º–æ–¥–µ–ª—å" —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
                            if (brand !== '–î—Ä—É–≥–∞—è –º–∞—Ä–∫–∞') {
                                const customOption = document.createElement('option');
                                customOption.value = '–î—Ä—É–≥–∞—è –º–æ–¥–µ–ª—å';
                                customOption.textContent = '–î—Ä—É–≥–∞—è –º–æ–¥–µ–ª—å';
                                modelSelect.appendChild(customOption);
                            }
                        } else if (brand === '–î—Ä—É–≥–∞—è –º–∞—Ä–∫–∞') {
                            // –î–ª—è "–î—Ä—É–≥–æ–π –º–∞—Ä–∫–∏" —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ –º–æ–¥–µ–ª–∏
                            const modelCustom = document.getElementById('model_custom');
                            if (modelCustom) {
                                modelCustom.classList.remove('hidden');
                            }
                        }
                        
                        app.updateProgress();
                    });
                    
                    modelSelect.addEventListener('change', function() {
                        const isCustomModel = this.value === '–î—Ä—É–≥–∞—è –º–æ–¥–µ–ª—å';
                        const modelCustom = document.getElementById('model_custom');
                        if (modelCustom) {
                            modelCustom.classList.toggle('hidden', !isCustomModel);
                            if (!isCustomModel) modelCustom.value = '';
                        }
                        app.updateProgress();
                    });
                }
                
                this.initMileageFields();
                
                const auctionTypeSelect = document.getElementById('auction_type');
                if (auctionTypeSelect) {
                    auctionTypeSelect.addEventListener('change', function() {
                        app.toggleAuctionLotField(this.value);
                    });
                }
                
                const decisionSelect = document.getElementById('decision');
                const inspectionFields = document.getElementById('inspectionFields');
                if (decisionSelect && inspectionFields) {
                    decisionSelect.addEventListener('change', function() {
                        const showInspectionFields = this.value === 'üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É';
                        inspectionFields.classList.toggle('hidden', !showInspectionFields);
                        if (showInspectionFields) {
                            const tomorrow = new Date();
                            tomorrow.setDate(tomorrow.getDate() + 1);
                            const dateInput = document.getElementById('inspection_date');
                            if (dateInput) {
                                dateInput.value = tomorrow.toISOString().split('T')[0];
                            }
                            const timeInput = document.getElementById('inspection_time');
                            if (timeInput) {
                                timeInput.value = '10:00';
                            }
                        }
                    });
                }
                
                const generateBtn = document.getElementById('generateBtn');
                const saveToDbBtn = document.getElementById('saveToDbBtn');
                const clearFormBtn = document.getElementById('clearFormBtn');
                const copyBtn = document.getElementById('copyBtn');
                const generatePDFReportBtn = document.getElementById('generatePDFReportBtn');
                
                if (generateBtn) generateBtn.addEventListener('click', () => this.generateReport());
                if (saveToDbBtn) saveToDbBtn.addEventListener('click', () => this.saveReportToDatabase());
                if (clearFormBtn) clearFormBtn.addEventListener('click', () => this.clearForm());
                if (copyBtn) copyBtn.addEventListener('click', () => this.copyToClipboard());
                if (generatePDFReportBtn) generatePDFReportBtn.addEventListener('click', () => this.generatePDFReportMultiPage());
                
                this.setupAutoSave();
                this.loadFormData();
                this.updateProgress();
            },
            initScrollToTop() {
                const btn = document.getElementById('scrollToTopBtn');
                if (!btn) {
                    console.log('–ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –Ω–∞–≤–µ—Ä—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                    return;
                }
                window.addEventListener('scroll', () => {
                    btn.classList.toggle('visible', window.pageYOffset > 300);
                });
                btn.addEventListener('click', () => {
                    this.playSound('click');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            },
            initModal() {
                const modal = document.getElementById('reportModal');
                const modalClose = document.getElementById('modalClose');
                const closeModalBtn = document.getElementById('closeModal');
                const copyModalReportBtn = document.getElementById('copyModalReport');
                
                if (modalClose) {
                    modalClose.addEventListener('click', () => {
                        this.playSound('click');
                        modal.classList.add('hidden');
                    });
                }
                if (closeModalBtn) {
                    closeModalBtn.addEventListener('click', () => {
                        this.playSound('click');
                        modal.classList.add('hidden');
                    });
                }
                if (copyModalReportBtn) {
                    copyModalReportBtn.addEventListener('click', () => {
                        this.copyModalReport();
                    });
                }
                if (modal) {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            this.playSound('click');
                            modal.classList.add('hidden');
                        }
                    });
                }
            },
            initTooltips() {
                let activeTooltip = null;
                function showTooltip(element, text) {
                    if (activeTooltip) {
                        activeTooltip.remove();
                        activeTooltip = null;
                    }
                    const tooltip = document.createElement('div');
                    tooltip.className = 'tooltip';
                    tooltip.textContent = text;
                    const rect = element.getBoundingClientRect();
                    tooltip.style.position = 'fixed';
                    tooltip.style.top = (rect.bottom + window.scrollY + 5) + 'px';
                    tooltip.style.left = (rect.left + window.scrollX) + 'px';
                    tooltip.style.zIndex = '10000';
                    document.body.appendChild(tooltip);
                    activeTooltip = tooltip;
                    setTimeout(() => {
                        if (activeTooltip === tooltip) {
                            tooltip.remove();
                            activeTooltip = null;
                        }
                    }, 5000);
                }
                function hideTooltip() {
                    if (activeTooltip) {
                        activeTooltip.remove();
                        activeTooltip = null;
                    }
                }
                const elementsWithTooltips = document.querySelectorAll('[data-tooltip]');
                elementsWithTooltips.forEach(element => {
                    element.addEventListener('mouseenter', function() {
                        showTooltip(this, this.getAttribute('data-tooltip'));
                    });
                    element.addEventListener('mouseleave', hideTooltip);
                    element.addEventListener('focus', function() {
                        showTooltip(this, this.getAttribute('data-tooltip'));
                    });
                    element.addEventListener('blur', hideTooltip);
                });
            },
            initInspectionsButtons() {
                const clearCompletedInspectionsBtn = document.getElementById('clearCompletedInspectionsBtn');
                if (clearCompletedInspectionsBtn) {
                    clearCompletedInspectionsBtn.addEventListener('click', () => {
                        this.playSound('click');
                        this.clearCompletedInspections();
                    });
                }
            },
            toggleAuctionLotField(auctionType) {
                const auctionLotGroup = document.getElementById('auctionLotNumberGroup');
                if (!auctionLotGroup) return;
                const showLotField = auctionType === '–ê—É–∫—Ü–∏–æ–Ω –Ø–ø–æ–Ω–∏–∏' || auctionType === '–ê—É–∫—Ü–∏–æ–Ω –°–®–ê (–±–∏—Ç—ã–π)';
                auctionLotGroup.classList.toggle('hidden', !showLotField);
            },
            updateProgress() {
                const brandEl = document.getElementById('brand');
                const modelEl = document.getElementById('model');
                const yearEl = document.getElementById('year');
                const mileageKm = document.getElementById('mileage_km');
                const mileageMiles = document.getElementById('mileage_miles');
                
                if (!brandEl || !modelEl || !yearEl) return;
                
                let brandFilled = !!brandEl.value;
                let modelFilled = !!modelEl.value;
                let mileageFilled = !!(mileageKm && mileageKm.value) || !!(mileageMiles && mileageMiles.value);
                
                if (brandEl.value === '–î—Ä—É–≥–∞—è –º–∞—Ä–∫–∞') {
                    const brandCustom = document.getElementById('brand_custom');
                    brandFilled = brandCustom && brandCustom.value.trim() !== '';
                }
                
                if (modelEl.value === '–î—Ä—É–≥–∞—è –º–æ–¥–µ–ª—å') {
                    const modelCustom = document.getElementById('model_custom');
                    modelFilled = modelCustom && modelCustom.value.trim() !== '';
                }
                
                const filled = (brandFilled ? 1 : 0) + (modelFilled ? 1 : 0) + (yearEl.value ? 1 : 0) + (mileageFilled ? 1 : 0);
                const progress = (filled / 4) * 100;
                
                const progressFill = document.getElementById('progressFill');
                const progressText = document.getElementById('progressText');
                
                if (progressFill) progressFill.style.width = `${progress}%`;
                if (progressText) {
                    if (progress === 100) {
                        progressText.textContent = '‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã!';
                        progressText.style.color = 'var(--success-color)';
                    } else {
                        progressText.textContent = `–ó–∞–ø–æ–ª–Ω–µ–Ω–æ ${filled} –∏–∑ 4 –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–ª–µ–π`;
                        progressText.style.color = 'var(--text-light)';
                    }
                }
            },
            setupAutoSave() {
                const form = document.getElementById('diagnosticForm');
                if (!form) return;
                
                const autoSaveHandler = () => {
                    this.saveFormData();
                    this.updateProgress();
                    this.showSaveIndicator();
                };
                
                const debouncedHandler = this.debounce(autoSaveHandler, 500);
                const formElements = form.querySelectorAll('input, select, textarea');
                formElements.forEach(element => {
                    element.addEventListener('input', debouncedHandler);
                    element.addEventListener('change', debouncedHandler);
                });
            },
            debounce(func, wait) {
                let timeout;
                return (...args) => {
                    const later = () => {
                        clearTimeout(timeout);
                        func.apply(this, args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },
            saveFormData() {
                try {
                    const form = document.getElementById('diagnosticForm');
                    if (!form) return;
                    const formData = new FormData(form);
                    const data = {};
                    for (const [key, value] of formData.entries()) {
                        data[key] = value;
                    }
                    localStorage.setItem('motodiag_form_data', JSON.stringify(data));
                } catch (e) {
                    console.warn('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã:', e);
                }
            },
            loadFormData() {
                try {
                    const savedData = localStorage.getItem('motodiag_form_data');
                    if (!savedData) return;
                    const data = JSON.parse(savedData);
                    Object.keys(data).forEach(key => {
                        const el = document.getElementById(key);
                        if (el) el.value = data[key];
                    });
                    
                    const brandEl = document.getElementById('brand');
                    if (brandEl && data.brand) {
                        brandEl.value = data.brand;
                        brandEl.dispatchEvent(new Event('change'));
                        setTimeout(() => {
                            const modelEl = document.getElementById('model');
                            if (modelEl && data.model) {
                                modelEl.value = data.model;
                                modelEl.dispatchEvent(new Event('change'));
                            }
                        }, 0);
                    }
                    
                    const brandCustom = document.getElementById('brand_custom');
                    const modelCustom = document.getElementById('model_custom');
                    const inspectionFields = document.getElementById('inspectionFields');
                    const auctionLotGroup = document.getElementById('auctionLotNumberGroup');
                    
                    if (brandCustom) brandCustom.classList.toggle('hidden', data.brand !== '–î—Ä—É–≥–∞—è –º–∞—Ä–∫–∞');
                    if (modelCustom) modelCustom.classList.toggle('hidden', data.model !== '–î—Ä—É–≥–∞—è –º–æ–¥–µ–ª—å');
                    if (inspectionFields) inspectionFields.classList.toggle('hidden', data.decision !== 'üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É');
                    if (auctionLotGroup && data.auction_type) {
                        this.toggleAuctionLotField(data.auction_type);
                    }
                } catch (e) {
                    console.warn('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ä–º—ã:', e);
                }
            },
            showSaveIndicator() {
                const indicator = document.getElementById('saveIndicator');
                if (indicator) {
                    indicator.classList.add('visible');
                    this.playSound('save');
                    setTimeout(() => indicator.classList.remove('visible'), 2000);
                }
            },
            validateYear(year) {
                const currentYear = new Date().getFullYear();
                return year >= 1990 && year <= currentYear + 1;
            },
            validateForm() {
                let isValid = true;
                let errorMessage = '';
                let firstErrorElement = null;
                
                const brandEl = document.getElementById('brand');
                const modelEl = document.getElementById('model');
                const yearEl = document.getElementById('year');
                
                if (!brandEl || !modelEl || !yearEl) return false;
                
                if (!brandEl.value) {
                    isValid = false;
                    brandEl.style.borderColor = 'var(--danger-color)';
                    errorMessage = '–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É –º–æ—Ç–æ—Ü–∏–∫–ª–∞';
                    if (!firstErrorElement) firstErrorElement = brandEl;
                } else {
                    brandEl.style.borderColor = '';
                }
                
                if (!modelEl.value) {
                    isValid = false;
                    modelEl.style.borderColor = 'var(--danger-color)';
                    errorMessage = '–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –º–æ—Ç–æ—Ü–∏–∫–ª–∞';
                    if (!firstErrorElement) firstErrorElement = modelEl;
                } else {
                    modelEl.style.borderColor = '';
                }
                
                if (!yearEl.value) {
                    isValid = false;
                    yearEl.style.borderColor = 'var(--danger-color)';
                    errorMessage = '–£–∫–∞–∂–∏—Ç–µ –≥–æ–¥ –≤—ã–ø—É—Å–∫–∞';
                    if (!firstErrorElement) firstErrorElement = yearEl;
                } else {
                    const year = parseInt(yearEl.value, 10);
                    if (isNaN(year) || !this.validateYear(year)) {
                        isValid = false;
                        yearEl.style.borderColor = 'var(--danger-color)';
                        errorMessage = `–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–µ–∂–¥—É 1990 –∏ ${new Date().getFullYear() + 1}`;
                        if (!firstErrorElement) firstErrorElement = yearEl;
                    } else {
                        yearEl.style.borderColor = '';
                    }
                }
                
                if (brandEl.value === '–î—Ä—É–≥–∞—è –º–∞—Ä–∫–∞') {
                    const brandCustom = document.getElementById('brand_custom');
                    if (brandCustom && !brandCustom.value.trim()) {
                        isValid = false;
                        brandCustom.style.borderColor = 'var(--danger-color)';
                        errorMessage = '–£–∫–∞–∂–∏—Ç–µ –º–∞—Ä–∫—É –≤ –ø–æ–ª–µ "–í–≤–µ–¥–∏—Ç–µ –º–∞—Ä–∫—É"';
                        if (!firstErrorElement) firstErrorElement = brandCustom;
                    } else if (brandCustom) {
                        brandCustom.style.borderColor = '';
                    }
                }
                
                if (modelEl.value === '–î—Ä—É–≥–∞—è –º–æ–¥–µ–ª—å') {
                    const modelCustom = document.getElementById('model_custom');
                    if (modelCustom && !modelCustom.value.trim()) {
                        isValid = false;
                        modelCustom.style.borderColor = 'var(--danger-color)';
                        errorMessage = '–£–∫–∞–∂–∏—Ç–µ –º–æ–¥–µ–ª—å –≤ –ø–æ–ª–µ "–í–≤–µ–¥–∏—Ç–µ –º–æ–¥–µ–ª—å"';
                        if (!firstErrorElement) firstErrorElement = modelCustom;
                    } else if (modelCustom) {
                        modelCustom.style.borderColor = '';
                    }
                }
                
                const decision = document.getElementById('decision')?.value;
                if (decision === 'üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É') {
                    const requiredFields = ['inspection_date', 'inspection_time', 'inspection_address', 'customer_phone'];
                    requiredFields.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (field && !field.value.trim()) {
                            isValid = false;
                            field.style.borderColor = 'var(--danger-color)';
                            errorMessage = '–î–ª—è –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è';
                            if (!firstErrorElement) firstErrorElement = field;
                        } else if (field) {
                            field.style.borderColor = '';
                        }
                    });
                }
                
                if (!isValid) {
                    this.showToast(errorMessage || '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'warning');
                    this.playSound('error');
                    const generateBtn = document.getElementById('generateBtn');
                    if (generateBtn) {
                        generateBtn.classList.add('shake');
                        setTimeout(() => generateBtn.classList.remove('shake'), 500);
                    }
                    if (firstErrorElement) {
                        setTimeout(() => {
                            firstErrorElement.scrollIntoView({ 
                                behavior: 'smooth', 
                                block: 'center' 
                            });
                            firstErrorElement.classList.add('pulse');
                            setTimeout(() => firstErrorElement.classList.remove('pulse'), 1500);
                            if (firstErrorElement.tagName === 'INPUT' || firstErrorElement.tagName === 'SELECT') {
                                firstErrorElement.focus();
                            }
                        }, 300);
                    }
                }
                
                return isValid;
            },
            generateReport() {
                if (!this.validateForm()) return;
                
                try {
                    const form = document.getElementById('diagnosticForm');
                    const formData = new FormData(form);
                    const data = Object.fromEntries(formData.entries());
                    const report = this.generateReportText(data);
                    
                    const output = document.getElementById('output');
                    const outputCard = document.getElementById('outputCard');
                    const copyBtn = document.getElementById('copyBtn');
                    
                    if (output) output.textContent = report;
                    if (outputCard) outputCard.classList.remove('hidden');
                    if (copyBtn) {
                        copyBtn.textContent = 'üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π';
                        copyBtn.classList.remove('hidden');
                    }
                    
                    this.calculateAndShowSavings(data);
                    
                    if (outputCard) outputCard.scrollIntoView({ behavior: 'smooth' });
                    this.playSound('success');
                    this.showToast('–û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!', 'success');
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞:', e);
                    this.playSound('error');
                    this.showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ç—á–µ—Ç–∞', 'warning');
                }
            },
            generateReportText(data) {
                const brand = data.brand === '–î—Ä—É–≥–∞—è –º–∞—Ä–∫–∞' ? data.brand_custom : data.brand;
                const model = data.model === '–î—Ä—É–≥–∞—è –º–æ–¥–µ–ª—å' ? data.model_custom : data.model;
                
                let report = `üèçÔ∏è –ú–æ—Ç–æ–ø–æ–¥–±–æ—Ä, –æ—Å–º–æ—Ç—Ä –º–æ—Ç–æ—Ü–∏–∫–ª–∞ –ø–µ—Ä–µ–¥ –ø–æ–∫—É–ø–∫–æ–π, –≤—ã–µ–∑–¥–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞, –ø–æ–¥–±–æ—Ä –ø–æ–¥ –∫–ª—é—á.\n`;
                report += `üìû –°–µ—Ä–≥–µ–π –õ–∞–Ω–¥–∏–∫ 8 950 005-05-08\n`;
                report += `üåê –°–∞–π—Ç: motopodbor.ru\n\n`;
                report += `üèçÔ∏è ${brand} ${model}\n`;
                
                if (data.year) report += `üìÖ –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: ${data.year}\n`;
                
                if (data.mileage_km) {
                    const km = parseFloat(data.mileage_km);
                    if (!isNaN(km)) {
                        const miles = this.convertKmToMiles(km);
                        report += `üõ£Ô∏è –ü—Ä–æ–±–µ–≥: ${km} —Ç—ã—Å. –∫–º (${miles} —Ç—ã—Å. –º–∏–ª—å)\n`;
                    }
                } else if (data.mileage_miles) {
                    const miles = parseFloat(data.mileage_miles);
                    if (!isNaN(miles)) {
                        const km = this.convertMilesToKm(miles);
                        report += `üõ£Ô∏è –ü—Ä–æ–±–µ–≥: ${miles} —Ç—ã—Å. –º–∏–ª—å (${km} —Ç—ã—Å. –∫–º)\n`;
                    }
                }
                
                if (data.origin_country) report += `üåç –ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ: ${data.origin_country}\n`;
                if (data.auction_type) report += `üè∑Ô∏è –ê—É–∫—Ü–∏–æ–Ω/–ø–æ—Å—Ç–∞–≤–∫–∞: ${data.auction_type}\n`;
                if (data.auction_lot_number) report += `üìã –ù–æ–º–µ—Ä –ª–æ—Ç–∞/—Å—Å—ã–ª–∫–∞: ${data.auction_lot_number}\n`;
                if (data.motorcycle_class) report += `üè∑Ô∏è –ö–ª–∞—Å—Å: ${data.motorcycle_class}\n`;
                if (data.legal_check) report += `üìã –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: ${data.legal_check}\n`;
                if (data.legal_status) report += `‚öñÔ∏è –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ç—É—Å: ${data.legal_status}\n`;
                if (data.legal_comment) report += `üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${data.legal_comment}\n`;
                
                report += `\nüíº –í–´–í–û–î–´:\n`;
                if (data.key_finding) report += `üîë –ö–ª—é—á–µ–≤–∞—è –Ω–∞—Ö–æ–¥–∫–∞: ${data.key_finding}\n`;
                if (data.expert_verdict) report += `üë®‚Äçüíº –í–µ—Ä–¥–∏–∫—Ç —ç–∫—Å–ø–µ—Ä—Ç–∞: ${data.expert_verdict}\n`;
                
                if (data.decision) {
                    report += `ü§î –†–µ—à–µ–Ω–∏–µ: ${data.decision}\n`;
                    if (data.decision === 'üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É') {
                        if (data.inspection_date && data.inspection_time) {
                            const inspectionDate = new Date(data.inspection_date + 'T' + data.inspection_time);
                            report += `üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: ${inspectionDate.toLocaleString('ru-RU')}\n`;
                        }
                        if (data.inspection_address) report += `üìç –ê–¥—Ä–µ—Å: ${data.inspection_address}\n`;
                    }
                }
                
                if (data.price || data.objective_cost || data.seller_discount || data.investment_cost) {
                    report += `\nüí∞ –§–ò–ù–ê–ù–°–û–í–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø:\n`;
                    if (data.price) report += `üíµ –¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–≤—Ü–∞: ${this.formatMoneyDisplay(data.price)}\n`;
                    if (data.objective_cost) report += `üìä –û–±—ä–µ–∫—Ç–∏–≤–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${this.formatMoneyDisplay(data.objective_cost)}\n`;
                    if (data.seller_discount) report += `üéÅ –°–∫–∏–¥–∫–∞ —Å –ø—Ä–æ–¥–∞–≤—Ü–∞: ${this.formatMoneyDisplay(data.seller_discount)}\n`;
                    if (data.investment_cost) report += `üîß –°—Ç–æ–∏–º–æ—Å—Ç—å –≤–ª–æ–∂–µ–Ω–∏–π: ${this.formatMoneyDisplay(data.investment_cost)}\n`;
                }
                
                report += `\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`;
                report += `üìû –ì–æ—Ç–æ–≤—ã –Ω–∞–π—Ç–∏ —Å–≤–æ–π –∏–¥–µ–∞–ª—å–Ω—ã–π –º–æ—Ç–æ—Ü–∏–∫–ª?\n`;
                report += `–ó–≤–æ–Ω–∏—Ç–µ: 8 950 005-05-08\n`;
                report += `–ú—ã –ø–æ–º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä! ‚úÖ`;
                
                return report;
            },
            async generatePDFReportMultiPage() {
                if (!this.validateForm()) return;
                
                if (this.state.pdfGenerationInProgress) {
                    this.showToast('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è', 'warning');
                    return;
                }
                
                try {
                    if (typeof window.jspdf === 'undefined') {
                        this.showToast('–û—à–∏–±–∫–∞: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ jsPDF –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'warning');
                        console.error('jsPDF –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                        return;
                    }
                    if (typeof html2canvas === 'undefined') {
                        this.showToast('–û—à–∏–±–∫–∞: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ html2canvas –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'warning');
                        console.error('html2canvas –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                        return;
                    }

                    const form = document.getElementById('diagnosticForm');
                    const formData = new FormData(form);
                    const data = Object.fromEntries(formData.entries());
                    
                    this.showPDFProgress(0, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
                    
                    const htmlContent = this.generatePDFHtmlContentMultiPage(data);
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF('p', 'mm', 'a4');
                    
                    doc.setProperties({
                        title: `–û—Ç—á–µ—Ç –ø–æ –º–æ—Ç–æ—Ü–∏–∫–ª—É ${data.brand || ''} ${data.model || ''}`,
                        subject: '–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç',
                        author: 'Motopodbor.ru PRO',
                        keywords: '–º–æ—Ç–æ—Ü–∏–∫–ª, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞, –æ—Ç—á–µ—Ç',
                        creator: 'Motopodbor.ru PRO'
                    });

                    const tempContainer = document.createElement('div');
                    tempContainer.style.width = '210mm';
                    tempContainer.style.minHeight = '297mm';
                    tempContainer.style.padding = '15mm';
                    tempContainer.style.background = 'white';
                    tempContainer.style.color = 'black';
                    tempContainer.style.fontFamily = 'Arial, sans-serif';
                    tempContainer.style.position = 'absolute';
                    tempContainer.style.left = '-9999px';
                    tempContainer.style.boxSizing = 'border-box';
                    tempContainer.innerHTML = htmlContent;
                    document.body.appendChild(tempContainer);

                    const pages = tempContainer.querySelectorAll('.pdf-page');
                    const totalPages = pages.length;
                    
                    this.state.pdfGenerationInProgress = true;
                    this.state.pdfGenerationCanceled = false;
                    
                    this.showToast(`–ù–∞—á–∏–Ω–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é PDF (${totalPages} —Å—Ç—Ä–∞–Ω–∏—Ü)...`, 'info');

                    for (let pageIndex = 0; pageIndex < totalPages; pageIndex++) {
                        if (this.state.pdfGenerationCanceled) {
                            break;
                        }
                        
                        const progress = ((pageIndex + 1) / totalPages) * 100;
                        this.showPDFProgress(progress, `–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${pageIndex + 1} –∏–∑ ${totalPages}`);
                        
                        if (pageIndex > 0) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                        }
                        
                        const page = pages[pageIndex];
                        
                        try {
                            const canvas = await html2canvas(page, {
                                scale: 3,
                                useCORS: true,
                                logging: false,
                                backgroundColor: '#ffffff',
                                width: page.offsetWidth,
                                height: page.offsetHeight,
                                windowWidth: page.scrollWidth,
                                windowHeight: page.scrollHeight
                            });

                            const imgData = canvas.toDataURL('image/png');
                            const imgWidth = 210;
                            const imgHeight = (canvas.height * imgWidth) / canvas.width;

                            if (pageIndex > 0) {
                                doc.addPage();
                            }
                            
                            doc.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                            
                        } catch (error) {
                            console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã PDF:', error);
                            document.body.removeChild(tempContainer);
                            this.hidePDFProgress();
                            this.state.pdfGenerationInProgress = false;
                            this.playSound('error');
                            this.showToast(`–û—à–∏–±–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ${pageIndex + 1}: ${error.message}`, 'warning');
                            return;
                        }
                    }

                    if (!this.state.pdfGenerationCanceled) {
                        const filename = `–û—Ç—á–µ—Ç_${(data.brand || '–º–æ—Ç–æ—Ü–∏–∫–ª').replace(/[^\w]/g, '_')}_${(data.model || '').replace(/[^\w]/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                        doc.save(filename);
                        document.body.removeChild(tempContainer);
                        this.hidePDFProgress();
                        this.state.pdfGenerationInProgress = false;
                        this.playSound('success');
                        this.showToast(`PDF –æ—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω! (${totalPages} —Å—Ç—Ä–∞–Ω–∏—Ü)`, 'success');
                    } else {
                        document.body.removeChild(tempContainer);
                        this.hidePDFProgress();
                        this.state.pdfGenerationInProgress = false;
                        this.playSound('warning');
                        this.showToast('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –æ—Ç–º–µ–Ω–µ–Ω–∞', 'warning');
                    }

                } catch (e) {
                    console.error('–û–±—â–∞—è –æ—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF –æ—Ç—á–µ—Ç–∞:', e);
                    this.hidePDFProgress();
                    this.state.pdfGenerationInProgress = false;
                    this.playSound('error');
                    this.showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF –æ—Ç—á–µ—Ç–∞: ' + e.message, 'warning');
                }
            },
            cancelPDFGeneration() {
                this.state.pdfGenerationCanceled = true;
            },
            showPDFProgress(percent, message) {
                const progressModal = document.getElementById('pdfProgress');
                const progressFill = document.getElementById('pdfProgressFill');
                const progressText = document.getElementById('pdfProgressText');
                const pageStatus = document.getElementById('pdfPageStatus');
                
                if (progressModal) progressModal.classList.remove('hidden');
                if (progressFill) progressFill.style.width = percent + '%';
                if (progressText) progressText.textContent = message;
                if (pageStatus && percent > 0) {
                    pageStatus.textContent = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${Math.round(percent)}%`;
                }
            },
            hidePDFProgress() {
                const progressModal = document.getElementById('pdfProgress');
                if (progressModal) progressModal.classList.add('hidden');
            },
            generatePDFHtmlContentMultiPage(data) {
                const brand = data.brand === '–î—Ä—É–≥–∞—è –º–∞—Ä–∫–∞' ? data.brand_custom : data.brand;
                const model = data.model === '–î—Ä—É–≥–∞—è –º–æ–¥–µ–ª—å' ? data.model_custom : data.model;
                const currentDate = new Date().toLocaleDateString('ru-RU');
                
                let totalPages = 1;
                
                const inspectionFields = [
                    { section: 'engine', label: '–û—Å–º–æ—Ç—Ä –û–±—â–∏–π, –í–Ω–µ—à–Ω–∏–π –≤–∏–¥', value: data.inspection_engine },
                    { section: 'consumables', label: '–°–æ—Å—Ç–æ—è–Ω–∏–µ –õ–ö–ü', value: data.inspection_consumables },
                    { section: 'electrical', label: '–°–æ—Å—Ç–æ—è–Ω–∏–µ –°–∏–¥–µ–Ω—å—è', value: data.inspection_electrical },
                    { section: 'suspension', label: '–û—Å–º–æ—Ç—Ä –û–ø—Ç–∏–∫–∏', value: data.inspection_suspension },
                    { section: 'fuel_system', label: '–†–∞–º–∞, –®–≤—ã, –í—Ç–æ—Ä–∏—á–Ω–∞—è –æ–∫—Ä–∞—Å–∫–∞', value: data.inspection_fuel_system },
                    { section: 'brake_system', label: '–ö—Ä–∏–º–∏–Ω–∞–ª, –í–∏–Ω –Ω–æ–º–µ—Ä–∞, –ù–æ–º–µ—Ä–∞ –î–≤–∏–≥–∞—Ç–µ–ª—è', value: data.inspection_brake_system },
                    { section: 'cooling_system', label: '–ì–µ–æ–º–µ—Ç—Ä–∏—è, –ü–æ–¥—Ä–∞–º–Ω–∏–∫–∞, —Ä—É–ª—è, –≤–∏–ª–∫–∏', value: data.inspection_cooling_system },
                    { section: 'controls', label: '–û—Ä–≥–∞–Ω—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è', value: data.inspection_controls },
                    { section: 'additional_equipment', label: '–ú–æ—Ç–æ—Ä–Ω—ã–π –£–∑–µ–ª', value: data.inspection_additional_equipment },
                    { section: 'bodywork', label: '–¢–æ–ø–ª–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞', value: data.inspection_bodywork },
                    { section: 'electrical_new', label: '–°–∏—Å—Ç–µ–º–∞ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è', value: data.inspection_electrical_new },
                    { section: 'brake_system_new', label: '–≠–ª–µ–∫—Ç—Ä–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ', value: data.inspection_brake_system_new },
                    { section: 'drive', label: '–¢–æ—Ä–º–æ–∑–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞', value: data.inspection_drive },
                    { section: 'tires', label: '–ü—Ä–∏–≤–æ–¥', value: data.inspection_tires },
                    { section: 'suspension_front_rear', label: '–†–µ–∑–∏–Ω–∞', value: data.inspection_suspension_front_rear },
                    { section: 'computer_diagnostics', label: '–ü–æ–¥–≤–µ—Å–∫–∞ –ø–µ—Ä–µ–¥, –∑–∞–¥', value: data.inspection_computer_diagnostics },
                    { section: 'additional_equipment_new', label: '–ö–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞', value: data.inspection_additional_equipment_new },
                    { section: 'final', label: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ', value: data.inspection_final },
                    { section: 'geometry', label: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏', value: data.inspection_geometry }
                ];
                
                inspectionFields.forEach(field => {
                    const hasText = field.value && field.value.trim() !== '';
                    const hasPhotos = this.state.currentPhotos[field.section] && this.state.currentPhotos[field.section].length > 0;
                    if (hasText || hasPhotos) {
                        const photos = hasPhotos ? this.state.currentPhotos[field.section] : [];
                        const photosPerPage = 9;
                        const photoGroups = [];
                        for (let i = 0; i < photos.length; i += photosPerPage) {
                            photoGroups.push(photos.slice(i, i + photosPerPage));
                        }
                        if (photoGroups.length === 0) {
                            totalPages++;
                        } else {
                            totalPages += photoGroups.length;
                        }
                    }
                });

                totalPages++;

                let currentPage = 1;
                let html = '';

                html += this.generateFirstPage(data, currentPage, totalPages, currentDate);
                currentPage++;

                inspectionFields.forEach(field => {
                    const hasText = field.value && field.value.trim() !== '';
                    const hasPhotos = this.state.currentPhotos[field.section] && this.state.currentPhotos[field.section].length > 0;
                    if (hasText || hasPhotos) {
                        const photos = hasPhotos ? this.state.currentPhotos[field.section] : [];
                        const photosPerPage = 9;
                        const photoGroups = [];
                        for (let i = 0; i < photos.length; i += photosPerPage) {
                            photoGroups.push(photos.slice(i, i + photosPerPage));
                        }
                        if (photoGroups.length === 0) {
                            html += this.generateInspectionPage(field, hasText ? field.value : null, [], currentPage, totalPages, false, brand, model, currentDate);
                            currentPage++;
                        } else {
                            photoGroups.forEach((group, index) => {
                                const isFirstPage = index === 0;
                                const isContinued = index > 0;
                                const pageText = isFirstPage && hasText ? field.value : null;
                                html += this.generateInspectionPage(field, pageText, group, currentPage, totalPages, isContinued, brand, model, currentDate);
                                currentPage++;
                            });
                        }
                    }
                });

                html += this.generateAgreementPage(currentPage, totalPages, currentDate);

                return html;
            },
            generateFirstPage(data, currentPage, totalPages, currentDate) {
                const brand = data.brand === '–î—Ä—É–≥–∞—è –º–∞—Ä–∫–∞' ? data.brand_custom : data.brand;
                const model = data.model === '–î—Ä—É–≥–∞—è –º–æ–¥–µ–ª—å' ? data.model_custom : data.model;
                
                let html = `
                <div class="pdf-template">
                    <div class="pdf-page">
                        <div style="position: absolute; top: 5mm; right: 5mm; font-size: 30px; opacity: 0.1; color: #ccc; transform: rotate(-45deg);">motopodbor.ru</div>
                        <div style="text-align: center; margin-bottom: 15px;">
                            <h1 style="font-size: 20px; margin-bottom: 6px; color: #333;">–û–¢–ß–ï–¢ –û –î–ò–ê–ì–ù–û–°–¢–ò–ö–ï –ú–û–¢–û–¶–ò–ö–õ–ê</h1>
                            <p style="font-size: 12px; color: #666;">Motopodbor.ru PRO - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –ø–æ–¥–±–æ—Ä –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤</p>
                        </div>
                        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                            <div style="flex: 1;">
                                ${this.state.currentPhotos['exterior'] && this.state.currentPhotos['exterior'].length > 0 ? `
                                    <div style="text-align: center; margin-bottom: 12px;">
                                        <img src="${this.state.currentPhotos['exterior'][0].data}" style="max-width: 100%; max-height: 650px; width: auto; height: auto; object-fit: contain; border-radius: 4px; border: 1px solid #ddd;" alt="–§–æ—Ç–æ —Ç–∏—Ç—É–ª—å–Ω–æ–≥–æ –ª–∏—Å—Ç–∞">
                                        <div style="font-size: 9px; color: #666; margin-top: 4px;">–û—Å–Ω–æ–≤–Ω–æ–µ —Ñ–æ—Ç–æ –º–æ—Ç–æ—Ü–∏–∫–ª–∞</div>
                                    </div>
                                ` : `
                                    <div style="text-align: center; margin-bottom: 12px; padding: 30px; background: #f8f9fa; border-radius: 4px; border: 2px dashed #ddd;">
                                        <div style="font-size: 12px; color: #666;">–§–æ—Ç–æ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ</div>
                                    </div>
                                `}
                            </div>
                            <div style="flex: 2;">
                                <div style="background: #f8f9fa; border-radius: 6px; padding: 10px; margin-bottom: 12px;">
                                    <h2 style="font-size: 14px; margin: 0 0 8px 0; padding-bottom: 5px; border-bottom: 1px solid #3498db;">–û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 9px;">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">–ú–∞—Ä–∫–∞:</span> ${this.escapeHtml(brand || '–ù–µ —É–∫–∞–∑–∞–Ω–∞')}
                                        </div>
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">–ú–æ–¥–µ–ª—å:</span> ${this.escapeHtml(model || '–ù–µ —É–∫–∞–∑–∞–Ω–∞')}
                                        </div>
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞:</span> ${this.escapeHtml(data.year || '–ù–µ —É–∫–∞–∑–∞–Ω')}
                                        </div>
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">–ü—Ä–æ–±–µ–≥:</span> ${data.mileage_km ? this.escapeHtml(data.mileage_km) + ' —Ç—ã—Å. –∫–º' : data.mileage_miles ? this.escapeHtml(data.mileage_miles) + ' —Ç—ã—Å. –º–∏–ª—å' : '–ù–µ —É–∫–∞–∑–∞–Ω'}
                                        </div>
                                        ${data.vin ? `
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">VIN:</span> ${this.escapeHtml(data.vin)}
                                        </div>
                                        ` : ''}
                                        ${data.engine_number ? `
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">–î–≤–∏–≥–∞—Ç–µ–ª—å:</span> ${this.escapeHtml(data.engine_number)}
                                        </div>
                                        ` : ''}
                                        ${data.license_plate ? `
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">–ì–æ—Å. –Ω–æ–º–µ—Ä:</span> ${this.escapeHtml(data.license_plate)}
                                        </div>
                                        ` : ''}
                                        ${data.motorcycle_class ? `
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">–ö–ª–∞—Å—Å:</span> ${this.escapeHtml(data.motorcycle_class)}
                                        </div>
                                        ` : ''}
                                        ${data.gearbox_type ? `
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">–¢–∏–ø –∫–æ—Ä–æ–±–∫–∏:</span> ${this.escapeHtml(data.gearbox_type)}
                                        </div>
                                        ` : ''}
                                        ${data.origin_country ? `
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ:</span> ${this.escapeHtml(data.origin_country)}
                                        </div>
                                        ` : ''}
                                        ${data.auction_type ? `
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">–ê—É–∫—Ü–∏–æ–Ω/–ø–æ—Å—Ç–∞–≤–∫–∞:</span> ${this.escapeHtml(data.auction_type)}
                                        </div>
                                        ` : ''}
                                        ${data.auction_lot_number ? `
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">–ù–æ–º–µ—Ä –ª–æ—Ç–∞:</span> ${this.escapeHtml(data.auction_lot_number)}
                                        </div>
                                        ` : ''}
                                    </div>
                                </div>
                                ${(data.legal_check || data.legal_status || data.legal_comment || data.pts_type) ? `
                                <div style="background: #f8f9fa; border-radius: 6px; padding: 10px; margin-bottom: 12px;">
                                    <h2 style="font-size: 14px; margin: 0 0 8px 0; padding-bottom: 5px; border-bottom: 1px solid #3498db;">–î–æ–∫—É–º–µ–Ω—Ç—ã –∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å</h2>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 9px;">
                                        ${data.legal_check ? `
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:</span> ${this.escapeHtml(data.legal_check)}
                                        </div>
                                        ` : ''}
                                        ${data.legal_status ? `
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ç—É—Å:</span> ${this.escapeHtml(data.legal_status)}
                                        </div>
                                        ` : ''}
                                        ${data.pts_type ? `
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">–¢–∏–ø –ü–¢–°:</span> ${this.escapeHtml(data.pts_type)}
                                        </div>
                                        ` : ''}
                                    </div>
                                </div>
                                ` : ''}
                                ${(data.price || data.objective_cost || data.seller_discount || data.investment_cost) ? `
                                <div style="background: #f8f9fa; border-radius: 6px; padding: 10px; margin-bottom: 12px;">
                                    <h2 style="font-size: 14px; margin: 0 0 8px 0; padding-bottom: 5px; border-bottom: 1px solid #3498db;">–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 9px;">
                                        ${data.price ? `
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–≤—Ü–∞:</span> ${this.escapeHtml(this.formatMoneyDisplay(data.price))}
                                        </div>
                                        ` : ''}
                                        ${data.objective_cost ? `
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">–û–±—ä–µ–∫—Ç–∏–≤–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</span> ${this.escapeHtml(this.formatMoneyDisplay(data.objective_cost))}
                                        </div>
                                        ` : ''}
                                        ${data.seller_discount ? `
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">–°–∫–∏–¥–∫–∞ —Å –ø—Ä–æ–¥–∞–≤—Ü–∞:</span> ${this.escapeHtml(this.formatMoneyDisplay(data.seller_discount))}
                                        </div>
                                        ` : ''}
                                        ${data.investment_cost ? `
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: bold;">–°—Ç–æ–∏–º–æ—Å—Ç—å –≤–ª–æ–∂–µ–Ω–∏–π:</span> ${this.escapeHtml(this.formatMoneyDisplay(data.investment_cost))}
                                        </div>
                                        ` : ''}
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        ${(data.key_finding || data.expert_verdict) ? `
                        <h2 style="font-size: 16px; margin: 15px 0 10px 0; padding-bottom: 6px; border-bottom: 2px solid #3498db;">–í—ã–≤–æ–¥—ã</h2>
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; border-left: 4px solid #3498db; margin-bottom: 12px;">
                            ${data.key_finding ? `
                            <div style="margin-bottom: 6px;">
                                <strong>–ö–ª—é—á–µ–≤–∞—è –Ω–∞—Ö–æ–¥–∫–∞:</strong> ${this.escapeHtml(data.key_finding)}
                            </div>
                            ` : ''}
                            ${data.expert_verdict ? `
                            <div>
                                <strong>–≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –≤–µ—Ä–¥–∏–∫—Ç:</strong> ${this.escapeHtml(data.expert_verdict)}
                            </div>
                            ` : ''}
                        </div>
                        ` : ''}
                        ${data.decision ? `
                        <h2 style="font-size: 16px; margin: 15px 0 10px 0; padding-bottom: 6px; border-bottom: 2px solid #3498db;">–†–µ—à–µ–Ω–∏–µ</h2>
                        <div style="background: ${data.decision === '‚úÖ –ö—É–ø–ª–µ–Ω' ? '#d4edda' : data.decision === '‚ùå –ù–µ –ö—É–ø–ª–µ–Ω' ? '#f8d7da' : data.decision === '‚è≥ –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ' ? '#fff3cd' : '#e8f4fd'}; 
                                    padding: 10px; border-radius: 5px; border-left: 4px solid ${data.decision === '‚úÖ –ö—É–ø–ª–µ–Ω' ? '#28a745' : data.decision === '‚ùå –ù–µ –ö—É–ø–ª–µ–Ω' ? '#dc3545' : data.decision === '‚è≥ –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ' ? '#ffc107' : '#3498db'}; margin-bottom: 12px;">
                            <strong>–†–µ—à–µ–Ω–∏–µ:</strong> ${this.escapeHtml(data.decision)}
                        </div>
                        ` : ''}
                        <div style="position: absolute; bottom: 8mm; left: 8mm; right: 8mm; font-size: 9px; color: #666; text-align: center; border-top: 1px solid #eee; padding-top: 6px;">
                            –û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: ${currentDate} | –°–µ—Ä–≥–µ–π –õ–∞–Ω–¥–∏–∫ 8 950 005-05-08 | motopodbor.ru
                        </div>
                        <div style="position: absolute; bottom: 5mm; right: 8mm; font-size: 9px; color: #666;">
                            –°—Ç—Ä–∞–Ω–∏—Ü–∞ ${currentPage} –∏–∑ ${totalPages}
                        </div>
                    </div>
                `;
                return html;
            },
            generateInspectionPage(field, text, photos, currentPage, totalPages, isContinued, brand, model, currentDate) {
                const photosPerRow = 3;
                const maxPhotosPerPage = 9;

                let html = `
                    <div class="pdf-page">
                        <div style="position: absolute; top: 5mm; right: 5mm; font-size: 30px; opacity: 0.1; color: #ccc; transform: rotate(-45deg);">motopodbor.ru</div>
                        <div style="text-align: center; margin-bottom: 15px;">
                            <h1 style="font-size: 18px; margin-bottom: 6px; color: #333;">${field.label.toUpperCase()}${isContinued ? ' (–ü–†–û–î–û–õ–ñ–ï–ù–ò–ï)' : ''}</h1>
                            <p style="font-size: 12px; color: #666;">${brand} ${model} - –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞</p>
                        </div>
                `;
                if (text) {
                    html += `
                        <h2 style="font-size: 14px; margin: 12px 0 8px 0; padding-bottom: 5px; border-bottom: 1px solid #3498db;">–û–ø–∏—Å–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è</h2>
                        <div style="font-size: 11px; line-height: 1.4; margin-bottom: 12px; background: #f8f9fa; padding: 8px; border-radius: 4px;">
                            ${this.escapeHtml(text)}
                        </div>
                    `;
                }
                if (photos.length > 0) {
                    html += `
                        <h2 style="font-size: 14px; margin: 12px 0 8px 0; padding-bottom: 5px; border-bottom: 1px solid #3498db;">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (${photos.length})</h2>
                        <div style="display: grid; grid-template-columns: repeat(${photosPerRow}, 1fr); gap: 6px; margin-bottom: 12px;">
                    `;
                    photos.forEach((photo, index) => {
                        const photoIndex = isContinued ? index + (currentPage - 2) * maxPhotosPerPage : index;
                        html += `
                            <div style="text-align: center;">
                                <img src="${photo.data}" style="max-width: 100%; max-height: 250px; width: auto; height: auto; object-fit: contain; border-radius: 4px; border: 1px solid #ddd;" alt="–§–æ—Ç–æ ${photoIndex + 1}">
                                <div style="font-size: 8px; color: #666; margin-top: 3px;">–§–æ—Ç–æ ${photoIndex + 1}</div>
                            </div>
                        `;
                    });
                    html += `</div>`;
                }
                html += `
                        <div style="position: absolute; bottom: 8mm; left: 8mm; right: 8mm; font-size: 9px; color: #666; text-align: center; border-top: 1px solid #eee; padding-top: 6px;">
                            –û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: ${currentDate} | –°–µ—Ä–≥–µ–π –õ–∞–Ω–¥–∏–∫ 8 950 005-05-08 | motopodbor.ru
                        </div>
                        <div style="position: absolute; bottom: 5mm; right: 8mm; font-size: 9px; color: #666;">
                            –°—Ç—Ä–∞–Ω–∏—Ü–∞ ${currentPage} –∏–∑ ${totalPages}
                        </div>
                    </div>
                `;
                return html;
            },
            generateAgreementPage(currentPage, totalPages, currentDate) {
                return `
                    <div class="pdf-page">
                        <div style="position: absolute; top: 5mm; right: 5mm; font-size: 30px; opacity: 0.1; color: #ccc; transform: rotate(-45deg);">motopodbor.ru</div>
                        <div style="text-align: center; margin-bottom: 20px;">
                            <h1 style="font-size: 20px; margin-bottom: 6px; color: #333;">–°–û–ì–õ–ê–®–ï–ù–ò–ï –û –ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–ò</h1>
                            <p style="font-size: 12px; color: #666;">Motopodbor.ru PRO</p>
                        </div>
                        
                        <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
                            <h2 style="font-size: 16px; margin: 0 0 12px 0; color: #333; text-align: center;">–£–°–õ–û–í–ò–Ø –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø –û–¢–ß–ï–¢–ê</h2>
                            
                            <div style="font-size: 11px; line-height: 1.5; color: #555;">
                                <p style="margin-bottom: 10px;"><strong>–í —Ä–∞–º–∫–∞—Ö –Ω–∞—à–µ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞ –º—ã, ¬´Motopodbor.ru PRO¬ª, –¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å —Å –≤–∞–º–∏, –ö–ª–∏–µ–Ω—Ç–æ–º, –æ —Å–ª–µ–¥—É—é—â–µ–º:</strong></p>
                                
                                <ul style="margin: 0 0 15px 0; padding-left: 20px;">
                                    <li style="margin-bottom: 8px;">
                                        <strong>–û—Ç—á–µ—Ç ‚Äî —ç—Ç–æ –≤–∞—à–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.</strong> –ú—ã –ø–µ—Ä–µ–¥–∞–µ–º –≤–∞–º –≥–æ—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç –æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –¥–ª—è –≤–∞—à–µ–≥–æ –ª–∏—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
                                    </li>
                                    <li style="margin-bottom: 8px;">
                                        <strong>–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å ‚Äî –Ω–∞—à –æ–±—â–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.</strong> –ú—ã –æ–±—è–∑—É–µ–º—Å—è –Ω–µ —Ä–∞–∑–≥–ª–∞—à–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –∏ –¥–∞–Ω–Ω—ã–µ –æ –º–æ—Ç–æ—Ü–∏–∫–ª–µ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º. –° –Ω–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω—ã –ø–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å.
                                    </li>
                                    <li style="margin-bottom: 8px;">
                                        <strong>–ü–µ—Ä–µ–¥–∞—á–∞ –æ—Ç—á–µ—Ç–∞ –¥—Ä—É–≥–∏–º ‚Äî —Ç–æ–ª—å–∫–æ —Å –≤–∞—à–µ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è.</strong> –ï—Å–ª–∏ –≤—ã —Ä–µ—à–∏—Ç–µ –ø–æ–∫–∞–∑–∞—Ç—å –æ—Ç—á–µ—Ç –¥—Ä—É–≥–æ–º—É –ª–∏—Ü—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º—É –ø–æ–∫—É–ø–∞—Ç–µ–ª—é –∏–ª–∏ –¥—Ä—É–≥–æ–º—É –º–µ—Ö–∞–Ω–∏–∫—É), –º—ã –ø—Ä–æ—Å–∏–º –≤–∞—Å —É–≤–µ–¥–æ–º–∏—Ç—å –Ω–∞—Å –æ–± —ç—Ç–æ–º —É—Å—Ç–Ω–æ. –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –º—ã –∑–Ω–∞–ª–∏, –∫–æ–º—É –∏ –∫–∞–∫ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.
                                    </li>
                                    <li style="margin-bottom: 8px;">
                                        <strong>–ú—ã –¥–æ–≤–µ—Ä—è–µ–º –≤–∞–º, –≤—ã –¥–æ–≤–µ—Ä—è–µ—Ç–µ –Ω–∞–º.</strong> –≠—Ç–∞ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ –≤–∑–∞–∏–º–Ω–æ–º –¥–æ–≤–µ—Ä–∏–∏. –ú—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ –≤—ã –±—É–¥–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç —Ä–∞–∑—É–º–Ω–æ, –∞ –≤—ã –º–æ–∂–µ—Ç–µ –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω—ã –≤ –Ω–∞—à–µ–π discretion.
                                    </li>
                                    <li style="margin-bottom: 8px;">
                                        <strong>–ú—ã –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏.</strong> –ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã –ø–æ –æ—Ç—á–µ—Ç—É –∏–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è ‚Äî –≤—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ –∫ –Ω–∞–º –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è.
                                    </li>
                                </ul>
                                
                                <div style="border-top: 1px solid #ddd; padding-top: 12px; margin-top: 15px;">
                                    <p style="margin: 0; text-align: center;"><strong>–° —É–≤–∞–∂–µ–Ω–∏–µ–º,<br>–°–µ—Ä–≥–µ–π –õ–∞–Ω–¥–∏–∫<br>Motopodbor.ru PRO</strong></p>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: #e8f4fd; border-radius: 6px; padding: 12px; margin-bottom: 15px; border-left: 4px solid #3498db;">
                            <h3 style="font-size: 14px; margin: 0 0 8px 0; color: #2c3e50;">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h3>
                            <div style="font-size: 10px; color: #555;">
                                <p style="margin: 4px 0;"><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> 8 950 005-05-08</p>
                                <p style="margin: 4px 0;"><strong>–°–∞–π—Ç:</strong> motopodbor.ru</p>
                                <p style="margin: 4px 0;"><strong>Email:</strong> landik.motopodbor@gmail.com</p>
                            </div>
                        </div>
                        
                        <div style="position: absolute; bottom: 8mm; left: 8mm; right: 8mm; font-size: 9px; color: #666; text-align: center; border-top: 1px solid #eee; padding-top: 6px;">
                            –û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: ${currentDate} | –°–µ—Ä–≥–µ–π –õ–∞–Ω–¥–∏–∫ 8 950 005-05-08 | motopodbor.ru
                        </div>
                        <div style="position: absolute; bottom: 5mm; right: 8mm; font-size: 9px; color: #666;">
                            –°—Ç—Ä–∞–Ω–∏—Ü–∞ ${currentPage} –∏–∑ ${totalPages}
                        </div>
                    </div>
                `;
            },
            formatMoneyDisplay(value) {
                if (!value) return '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
                if (typeof value === 'string' && (value.includes('—Ç—ã—Å') || value.includes('–º–ª–Ω'))) {
                    return value;
                }
                const numValue = this.parseMoneyValue(value);
                if (numValue >= 1000000) {
                    return (numValue / 1000000).toFixed(1).replace('.0', '') + ' –º–ª–Ω —Ä—É–±';
                } else if (numValue >= 1000) {
                    return (numValue / 1000).toFixed(0) + ' —Ç—ã—Å. —Ä—É–±';
                } else {
                    return numValue + ' —Ä—É–±';
                }
            },
            calculateAndShowSavings(data) {
                const price = this.parseMoneyValue(data.price);
                const objectiveCost = this.parseMoneyValue(data.objective_cost);
                const sellerDiscount = this.parseMoneyValue(data.seller_discount);
                const investmentCost = this.parseMoneyValue(data.investment_cost);
                const savingsAlert = document.getElementById('savingsAlert');
                if (price && objectiveCost && savingsAlert) {
                    const savings = (objectiveCost - (price - sellerDiscount)) - investmentCost;
                    if (savings > 0) {
                        savingsAlert.textContent = `üíµ –û–±—â–∞—è —ç–∫–æ–Ω–æ–º–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞: ${this.formatMoneyDisplay(savings.toString())}`;
                        savingsAlert.classList.remove('hidden');
                    } else {
                        savingsAlert.classList.add('hidden');
                    }
                } else if (savingsAlert) {
                    savingsAlert.classList.add('hidden');
                }
            },
            parseMoneyValue(value) {
                if (!value) return 0;
                let str = value.toString().toLowerCase().replace(/\s/g, '').replace(',', '.');
                let num = parseFloat(str);
                if (isNaN(num)) return 0;
                if (str.includes('–º–ª–Ω')) {
                    return num * 1000000;
                } else if (str.includes('—Ç—ã—Å') || str.includes('—Ç.—Ä.') || str.includes('–∫')) {
                    return num * 1000;
                } else if (str.includes('—Ä—É–±')) {
                    return num;
                } else {
                    if (num > 100000) {
                        return num;
                    } else {
                        return num * 1000;
                    }
                }
            },
            formatMoney(amount) {
                if (amount >= 1000000) {
                    return (amount / 1000000).toFixed(1).replace('.0', '') + ' –º–ª–Ω';
                } else if (amount >= 1000) {
                    return (amount / 1000).toFixed(0) + ' —Ç—ã—Å.';
                } else {
                    return amount + ' —Ä—É–±';
                }
            },
            saveInspectionToDatabase(data, reportId) {
                try {
                    const inspection = {
                        id: Date.now().toString(),
                        reportId: reportId,
                        timestamp: new Date().toISOString(),
                        brand: data.brand === '–î—Ä—É–≥–∞—è –º–∞—Ä–∫–∞' ? data.brand_custom : data.brand,
                        model: data.model === '–î—Ä—É–≥–∞—è –º–æ–¥–µ–ª—å' ? data.model_custom : data.model,
                        year: data.year,
                        date: data.inspection_date,
                        time: data.inspection_time,
                        address: data.inspection_address,
                        customer_phone: data.customer_phone,
                        seller_phone: data.seller_phone,
                        notes: data.inspection_notes,
                        status: 'planned',
                        reminded: false
                    };
                    this.state.inspectionsDatabase.push(inspection);
                    this.saveInspectionToIndexedDB(inspection);
                    this.playSound('success');
                    this.showToast('–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞!', 'success');
                    this.loadInspectionsList();
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏:', e);
                    this.playSound('error');
                    this.showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏', 'warning');
                }
            },
            clearForm() {
                if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã?')) return;
                const form = document.getElementById('diagnosticForm');
                if (form) form.reset();
                localStorage.removeItem('motodiag_form_data');
                const outputCard = document.getElementById('outputCard');
                const savingsAlert = document.getElementById('savingsAlert');
                const inspectionFields = document.getElementById('inspectionFields');
                const brandCustom = document.getElementById('brand_custom');
                const modelCustom = document.getElementById('model_custom');
                const auctionLotGroup = document.getElementById('auctionLotNumberGroup');
                if (outputCard) outputCard.classList.add('hidden');
                if (savingsAlert) savingsAlert.classList.add('hidden');
                if (inspectionFields) inspectionFields.classList.add('hidden');
                if (brandCustom) brandCustom.classList.add('hidden');
                if (modelCustom) modelCustom.classList.add('hidden');
                if (auctionLotGroup) auctionLotGroup.classList.add('hidden');
                const brandSelect = document.getElementById('brand');
                if (brandSelect) {
                    brandSelect.value = '';
                    brandSelect.dispatchEvent(new Event('change'));
                }
                this.clearAllPhotos();
                this.state.editingReportId = null;
                this.updateProgress();
                this.playSound('success');
                this.showToast('–§–æ—Ä–º–∞ –æ—á–∏—â–µ–Ω–∞', 'success');
            },
            copyToClipboard() {
                try {
                    const text = document.getElementById('output')?.textContent || '';
                    if (!text) {
                        this.playSound('error');
                        this.showToast('–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'warning');
                        return;
                    }
                    navigator.clipboard.writeText(text).then(() => {
                        this.playSound('success');
                        this.showToast('–û—Ç—á–µ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
                    }).catch(() => {
                        const textarea = document.createElement('textarea');
                        textarea.value = text;
                        document.body.appendChild(textarea);
                        textarea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textarea);
                        this.playSound('success');
                        this.showToast('–û—Ç—á–µ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
                    });
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', e);
                    this.playSound('error');
                    this.showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏', 'warning');
                }
            },
            copyModalReport() {
                try {
                    const text = document.getElementById('modalOutput')?.textContent || '';
                    if (!text) {
                        this.playSound('error');
                        this.showToast('–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'warning');
                        return;
                    }
                    navigator.clipboard.writeText(text).then(() => {
                        this.playSound('success');
                        this.showToast('–û—Ç—á–µ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π!', 'success');
                    }).catch(() => {
                        const textarea = document.createElement('textarea');
                        textarea.value = text;
                        document.body.appendChild(textarea);
                        textarea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textarea);
                        this.playSound('success');
                        this.showToast('–û—Ç—á–µ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π!', 'success');
                    });
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', e);
                    this.playSound('error');
                    this.showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏', 'warning');
                }
            },
            showToast(message, type = 'info') {
                const toastId = 'toast-' + Date.now();
                const container = document.getElementById('toastContainer');
                if (!container) return;
                if (this.state.activeToasts.size >= 3) {
                    const oldestToastId = Array.from(this.state.activeToasts)[0];
                    const oldestToast = document.getElementById(oldestToastId);
                    if (oldestToast) {
                        this.removeToast(oldestToast);
                    }
                }
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                toast.id = toastId;
                toast.setAttribute('role', 'status');
                toast.innerHTML = `
                    ${message}
                    <button class="toast-close" onclick="app.removeToast(document.getElementById('${toastId}'))" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
                `;
                container.appendChild(toast);
                this.state.activeToasts.add(toastId);
                switch(type) {
                    case 'success':
                        this.playSound('success');
                        break;
                    case 'warning':
                        this.playSound('warning');
                        break;
                    case 'error':
                        this.playSound('error');
                        break;
                    default:
                        this.playSound('notification');
                }
                requestAnimationFrame(() => toast.classList.add('show'));
                setTimeout(() => {
                    this.removeToast(toast);
                }, 4000);
            },
            removeToast(toastElement) {
                if (!toastElement) return;
                toastElement.classList.remove('show');
                setTimeout(() => {
                    if (toastElement.parentNode) {
                        toastElement.remove();
                    }
                    this.state.activeToasts.delete(toastElement.id);
                }, 300);
            },
            showError(message) {
                this.showToast(message, 'warning');
            },
            escapeHtml(str) {
                return String(str || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
            },
            loadReportsList() {
                const reportsList = document.getElementById('reportsList');
                if (!reportsList) return;
                const searchValue = (document.getElementById('searchReports')?.value || '').toLowerCase();
                if (this.state.reportsDatabase.length === 0) {
                    reportsList.innerHTML = '<div class="text-center" style="padding: 20px; color: var(--text-light);">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤</div>';
                    return;
                }
                const filtered = this.state.reportsDatabase.filter(report => {
                    if (!searchValue) return true;
                    return (
                        report.brand?.toLowerCase().includes(searchValue) ||
                        report.model?.toLowerCase().includes(searchValue) ||
                        (report.year && String(report.year).includes(searchValue)) ||
                        report.vin?.toLowerCase().includes(searchValue) ||
                        report.engine_number?.toLowerCase().includes(searchValue) ||
                        report.license_plate?.toLowerCase().includes(searchValue)
                    );
                }).reverse();
                if (filtered.length === 0) {
                    reportsList.innerHTML = '<div class="text-center" style="padding: 20px; color: var(--text-light);">–û—Ç—á–µ—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                    return;
                }
                reportsList.innerHTML = filtered.map(report => {
                    const hasPhotos = report.photos && Object.keys(report.photos).some(section => 
                        report.photos[section] && report.photos[section].length > 0
                    );
                    return `
                    <div class="report-item">
                        <div class="report-header">
                            <div class="report-title">${this.escapeHtml(report.brand)} ${this.escapeHtml(report.model)} (${this.escapeHtml(report.year)}) ${hasPhotos ? 'üì∑' : ''}</div>
                            <div class="report-actions">
                                <button class="action-btn" style="background: var(--secondary-color); color: white;" onclick="app.viewReport('${report.id}')" aria-label="–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á–µ—Ç">üëÅÔ∏è</button>
                                <button class="action-btn" style="background: var(--warning-color); color: white;" onclick="app.editReport('${report.id}')" aria-label="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç">‚úèÔ∏è</button>
                                <button class="action-btn" style="background: var(--danger-color); color: white;" onclick="app.deleteReport('${report.id}')" aria-label="–£–¥–∞–ª–∏—Ç—å –æ—Ç—á–µ—Ç">üóëÔ∏è</button>
                            </div>
                        </div>
                        <div class="report-meta">
                            <div>–ü—Ä–æ–±–µ–≥: ${this.escapeHtml(report.mileage_km || report.mileage_miles || '0')} ${report.mileage_km ? '—Ç—ã—Å.–∫–º' : report.mileage_miles ? '—Ç—ã—Å.–º–∏–ª—å' : ''}</div>
                            <div>–¶–µ–Ω–∞: ${this.escapeHtml(report.price || '–ù–µ —É–∫–∞–∑–∞–Ω–∞')}</div>
                            <div>${report.vin ? `VIN: ${this.escapeHtml(report.vin)}` : 'VIN: –ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                            <div>${report.engine_number ? `–î–≤–∏–≥–∞—Ç–µ–ª—å: ${this.escapeHtml(report.engine_number)}` : '–î–≤–∏–≥–∞—Ç–µ–ª—å: –ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                            <div>${report.license_plate ? `–ù–æ–º–µ—Ä: ${this.escapeHtml(report.license_plate)}` : '–ù–æ–º–µ—Ä: –ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                            <div>–ö–ª–∞—Å—Å: ${this.escapeHtml(report.motorcycle_class || '–ù–µ —É–∫–∞–∑–∞–Ω')}</div>
                            <div>–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ç—É—Å: ${this.escapeHtml(report.legal_status || '–ù–µ —É–∫–∞–∑–∞–Ω')}</div>
                            <div>–†–µ—à–µ–Ω–∏–µ: ${this.escapeHtml(report.decision || '–ù–µ —É–∫–∞–∑–∞–Ω–æ')}</div>
                        </div>
                    </div>
                `}).join('');
            },
            viewReport(reportId) {
                const report = this.state.reportsDatabase.find(r => r.id === reportId);
                if (!report) return;
                const modalVin = document.getElementById('modalVin');
                const modalEngineNumber = document.getElementById('modalEngineNumber');
                const modalLicensePlate = document.getElementById('modalLicensePlate');
                const modalBikeInfo = document.getElementById('modalBikeInfo');
                const modalOutput = document.getElementById('modalOutput');
                const reportModal = document.getElementById('reportModal');
                if (modalVin) modalVin.textContent = report.vin ? this.escapeHtml(report.vin) : '–ù–µ —É–∫–∞–∑–∞–Ω';
                if (modalEngineNumber) modalEngineNumber.textContent = report.engine_number ? this.escapeHtml(report.engine_number) : '–ù–µ —É–∫–∞–∑–∞–Ω';
                if (modalLicensePlate) modalLicensePlate.textContent = report.license_plate ? this.escapeHtml(report.license_plate) : '–ù–µ —É–∫–∞–∑–∞–Ω';
                if (modalBikeInfo) modalBikeInfo.textContent = `${this.escapeHtml(report.brand)} ${this.escapeHtml(report.model)} (${this.escapeHtml(report.year)})`;
                if (modalOutput) modalOutput.textContent = report.generated_text || '';
                if (reportModal) reportModal.classList.remove('hidden');
                this.playSound('click');
            },
            exportAllData() {
                try {
                    const allData = {
                        version: '2.7.1',
                        exportDate: new Date().toISOString(),
                        reports: this.state.reportsDatabase,
                        inspections: this.state.inspectionsDatabase,
                        currentPhotos: this.state.currentPhotos,
                        settings: {
                            theme: localStorage.getItem('motodiag_theme'),
                            soundEnabled: localStorage.getItem('motodiag_sound_enabled'),
                            autoSave: localStorage.getItem('motodiag_auto_save'),
                            inspectionNotifications: localStorage.getItem('motodiag_inspection_notifications'),
                            reminderTime: localStorage.getItem('motodiag_reminder_time')
                        },
                        formData: localStorage.getItem('motodiag_form_data')
                    };
                    const dataStr = JSON.stringify(allData, null, 2);
                    const dataBlob = new Blob([dataStr], {type: 'application/json'});
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(dataBlob);
                    link.download = `motodiag_all_data_${new Date().toISOString().split('T')[0]}.json`;
                    link.click();
                    this.playSound('success');
                    this.showToast('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö:', e);
                    this.playSound('error');
                    this.showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö', 'warning');
                }
            },
            importAllData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = e => {
                    const file = e.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = event => {
                        try {
                            const importedData = JSON.parse(event.target.result);
                            if (!importedData.reports || !importedData.inspections) {
                                throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
                            }
                            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.')) {
                                return;
                            }
                            this.state.reportsDatabase = importedData.reports;
                            this.state.inspectionsDatabase = importedData.inspections;
                            if (importedData.currentPhotos) {
                                this.state.currentPhotos = importedData.currentPhotos;
                            }
                            
                            const savePromises = [];
                            this.state.reportsDatabase.forEach(report => {
                                savePromises.push(this.saveReportToIndexedDB(report));
                            });
                            this.state.inspectionsDatabase.forEach(inspection => {
                                savePromises.push(this.saveInspectionToIndexedDB(inspection));
                            });
                            
                            Promise.all(savePromises).then(() => {
                                if (importedData.settings) {
                                    if (importedData.settings.theme) {
                                        localStorage.setItem('motodiag_theme', importedData.settings.theme);
                                    }
                                    if (importedData.settings.soundEnabled) {
                                        localStorage.setItem('motodiag_sound_enabled', importedData.settings.soundEnabled);
                                    }
                                    if (importedData.settings.autoSave) {
                                        localStorage.setItem('motodiag_auto_save', importedData.settings.autoSave);
                                    }
                                    if (importedData.settings.inspectionNotifications) {
                                        localStorage.setItem('motodiag_inspection_notifications', importedData.settings.inspectionNotifications);
                                    }
                                    if (importedData.settings.reminderTime) {
                                        localStorage.setItem('motodiag_reminder_time', importedData.settings.reminderTime);
                                    }
                                }
                                if (importedData.formData) {
                                    localStorage.setItem('motodiag_form_data', importedData.formData);
                                }
                                const theme = importedData.settings?.theme || 'light';
                                document.body.setAttribute('data-theme', theme);
                                const darkThemeCheckbox = document.getElementById('darkTheme');
                                if (darkThemeCheckbox) {
                                    darkThemeCheckbox.checked = theme === 'dark';
                                }
                                const soundCheckbox = document.getElementById('soundNotifications');
                                if (soundCheckbox && importedData.settings) {
                                    soundCheckbox.checked = importedData.settings.soundEnabled === 'true';
                                    this.state.soundEnabled = importedData.settings.soundEnabled === 'true';
                                }
                                const autoSaveCheckbox = document.getElementById('autoSave');
                                if (autoSaveCheckbox && importedData.settings) {
                                    autoSaveCheckbox.checked = importedData.settings.autoSave === 'true';
                                }
                                const inspectionNotificationsCheckbox = document.getElementById('inspectionNotifications');
                                if (inspectionNotificationsCheckbox && importedData.settings) {
                                    inspectionNotificationsCheckbox.checked = importedData.settings.inspectionNotifications === 'true';
                                }
                                const reminderTimeInput = document.getElementById('reminderTime');
                                if (reminderTimeInput && importedData.settings?.reminderTime) {
                                    reminderTimeInput.value = importedData.settings.reminderTime;
                                }
                                this.loadReportsList();
                                this.loadInspectionsList();
                                this.updateStatistics();
                                this.loadFormData();
                                this.loadPhotoPreviews();
                                this.playSound('success');
                                this.showToast('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
                            }).catch(error => {
                                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);
                                this.playSound('error');
                                this.showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö', 'warning');
                            });
                        } catch (error) {
                            console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö:', error);
                            this.playSound('error');
                            this.showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö', 'warning');
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            },
            updateStatistics() {
                const startDateEl = document.getElementById('startDate');
                const endDateEl = document.getElementById('endDate');
                
                let startDate = startDateEl ? new Date(startDateEl.value) : null;
                let endDate = endDateEl ? new Date(endDateEl.value) : null;

                // –ï—Å–ª–∏ –¥–∞—Ç—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã, –±–µ—Ä–µ–º –∑–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥
                if (!startDate || isNaN(startDate.getTime())) {
                    startDate = new Date(0); // —Å–∞–º–∞—è —Ä–∞–Ω–Ω—è—è –¥–∞—Ç–∞
                }
                if (!endDate || isNaN(endDate.getTime())) {
                    endDate = new Date(); // —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞
                }

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è endDate –Ω–∞ –∫–æ–Ω–µ—Ü –¥–Ω—è
                endDate.setHours(23, 59, 59, 999);

                const periodReports = this.state.reportsDatabase.filter(r => {
                    const reportDate = new Date(r.timestamp);
                    return reportDate >= startDate && reportDate <= endDate;
                });

                const totalReports = periodReports.length;

                // –ö–ª–∞—Å—Å –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤: —Å–æ—Å—Ç–∞–≤–∏–º –æ–±—ä–µ–∫—Ç —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ –∫–ª–∞—Å—Å–∞–º
                const classCounts = {};
                periodReports.forEach(r => {
                    if (r.motorcycle_class) {
                        classCounts[r.motorcycle_class] = (classCounts[r.motorcycle_class] || 0) + 1;
                    }
                });
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ: 5, –ì–æ–ª—ã–µ: 3")
                const classString = Object.keys(classCounts).map(cls => `${cls}: ${classCounts[cls]}`).join(', ') || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';

                // –ü–æ–ø—É–ª—è—Ä–Ω–∞—è –º–∞—Ä–∫–∞
                const brandCounts = {};
                periodReports.forEach(r => {
                    if (r.brand) {
                        brandCounts[r.brand] = (brandCounts[r.brand] || 0) + 1;
                    }
                });
                const brandKeys = Object.keys(brandCounts);
                const popularBrand = brandKeys.length > 0 ? 
                    brandKeys.reduce((a, b) => brandCounts[a] > brandCounts[b] ? a : b) : 
                    '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';

                // –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞
                let totalPrice = 0;
                let priceCount = 0;
                periodReports.forEach(r => {
                    const price = this.parseMoneyValue(r.price);
                    if (price > 0) {
                        totalPrice += price;
                        priceCount++;
                    }
                });
                const avgPrice = priceCount > 0 ? totalPrice / priceCount : 0;

                // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—à–µ–Ω–∏–π
                const purchasedCount = periodReports.filter(r => r.decision === '‚úÖ –ö—É–ø–ª–µ–Ω').length;
                const notPurchasedCount = periodReports.filter(r => r.decision === '‚ùå –ù–µ –ö—É–ø–ª–µ–Ω').length;
                const pendingCount = periodReports.filter(r => r.decision === '‚è≥ –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ').length;

                // –û–±–Ω–æ–≤–ª—è–µ–º DOM
                document.getElementById('totalReports').textContent = totalReports;
                document.getElementById('motorcycleClasses').textContent = classString;
                document.getElementById('popularBrand').textContent = popularBrand;
                document.getElementById('avgPrice').textContent = this.formatMoney(Math.round(avgPrice));
                document.getElementById('purchasedCount').textContent = purchasedCount;
                document.getElementById('notPurchasedCount').textContent = notPurchasedCount;
                document.getElementById('pendingCount').textContent = pendingCount;
            },
            loadInspectionsList() {
                const inspectionsList = document.getElementById('inspectionsList');
                if (!inspectionsList) return;
                const searchValue = (document.getElementById('searchInspections')?.value || '').toLowerCase();
                if (this.state.inspectionsDatabase.length === 0) {
                    inspectionsList.innerHTML = '<div class="text-center" style="padding: 20px; color: var(--text-light);">–ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫</div>';
                    return;
                }
                const filtered = this.state.inspectionsDatabase.filter(inspection => {
                    if (!searchValue) return true;
                    return (
                        inspection.brand?.toLowerCase().includes(searchValue) ||
                        inspection.model?.toLowerCase().includes(searchValue) ||
                        inspection.address?.toLowerCase().includes(searchValue) ||
                        inspection.customer_phone?.includes(searchValue)
                    );
                }).reverse();
                if (filtered.length === 0) {
                    inspectionsList.innerHTML = '<div class="text-center" style="padding: 20px; color: var(--text-light);">–ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                    return;
                }
                inspectionsList.innerHTML = filtered.map(inspection => {
                    const inspectionDateTime = new Date(inspection.date + 'T' + inspection.time);
                    const now = new Date();
                    const isOverdue = inspectionDateTime < now && inspection.status === 'planned';
                    const isToday = inspectionDateTime.toDateString() === now.toDateString();
                    return `
                        <div class="inspection-item ${inspection.status === 'completed' ? 'completed' : ''}">
                            <div class="inspection-header">
                                <div class="inspection-title">${this.escapeHtml(inspection.brand)} ${this.escapeHtml(inspection.model)} (${this.escapeHtml(inspection.year)})</div>
                                <div class="inspection-date">
                                    ${isToday ? 'üïê –°–µ–≥–æ–¥–Ω—è' : inspectionDateTime.toLocaleDateString('ru-RU')} ${inspection.time}
                                    ${isOverdue ? ' ‚ö†Ô∏è' : ''}
                                </div>
                            </div>
                            <div class="inspection-details">
                                <div><strong>–ê–¥—Ä–µ—Å:</strong> ${this.escapeHtml(inspection.address)}</div>
                                <div><strong>–¢–µ–ª–µ—Ñ–æ–Ω –∑–∞–∫–∞–∑—á–∏–∫–∞:</strong> ${this.escapeHtml(inspection.customer_phone)}</div>
                                ${inspection.seller_phone ? `<div><strong>–¢–µ–ª–µ—Ñ–æ–Ω –ø—Ä–æ–¥–∞–≤—Ü–∞:</strong> ${this.escapeHtml(inspection.seller_phone)}</div>` : ''}
                                ${inspection.notes ? `<div><strong>–ó–∞–º–µ—Ç–∫–∏:</strong> ${this.escapeHtml(inspection.notes)}</div>` : ''}
                                <div><strong>–°—Ç–∞—Ç—É—Å:</strong> ${inspection.status === 'completed' ? '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞' : 'üïê –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞'}</div>
                            </div>
                            <div class="inspection-actions">
                                ${inspection.status !== 'completed' ? `
                                    <button class="action-btn" style="background: var(--success-color); color: white;" onclick="app.completeInspection('${inspection.id}')" aria-label="–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é">‚úÖ</button>
                                    <button class="action-btn" style="background: var(--warning-color); color: white;" onclick="app.editInspection('${inspection.id}')" aria-label="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É">‚úèÔ∏è</button>
                                ` : ''}
                                <button class="action-btn" style="background: var(--primary-color); color: white;" onclick="app.viewReport('${inspection.reportId}')" aria-label="–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á–µ—Ç">üëÅÔ∏è</button>
                                <button class="action-btn" style="background: var(--danger-color); color: white;" onclick="app.deleteInspection('${inspection.id}')" aria-label="–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É">üóëÔ∏è</button>
                            </div>
                        </div>
                    `;
                }).join('');
            },
            completeInspection(inspectionId) {
                const inspection = this.state.inspectionsDatabase.find(i => i.id === inspectionId);
                if (inspection) {
                    inspection.status = 'completed';
                    this.saveInspectionToIndexedDB(inspection);
                    this.loadInspectionsList();
                    this.updateStatistics();
                    this.playSound('completion');
                    this.showToast('–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è', 'success');
                }
            },
            editInspection(inspectionId) {
                const inspection = this.state.inspectionsDatabase.find(i => i.id === inspectionId);
                if (!inspection) return;
                this.editReport(inspection.reportId);
            },
            deleteInspection(inspectionId) {
                if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø—Ä–æ–≤–µ—Ä–∫—É?')) return;
                this.state.inspectionsDatabase = this.state.inspectionsDatabase.filter(i => i.id !== inspectionId);
                const transaction = this.db.transaction([this.indexedDB.stores.INSPECTIONS], 'readwrite');
                const store = transaction.objectStore(this.indexedDB.stores.INSPECTIONS);
                store.delete(inspectionId);
                this.loadInspectionsList();
                this.updateStatistics();
                this.playSound('success');
                this.showToast('–ü—Ä–æ–≤–µ—Ä–∫–∞ —É–¥–∞–ª–µ–Ω–∞', 'success');
            },
            clearCompletedInspections() {
                if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏?')) return;
                
                try {
                    const completedInspections = this.state.inspectionsDatabase.filter(i => i.status === 'completed');
                    
                    if (completedInspections.length === 0) {
                        this.showToast('–ù–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è', 'info');
                        return;
                    }
                    
                    // –£–¥–∞–ª—è–µ–º –∏–∑ IndexedDB
                    const deletePromises = completedInspections.map(inspection => {
                        return new Promise((resolve, reject) => {
                            const transaction = this.db.transaction([this.indexedDB.stores.INSPECTIONS], 'readwrite');
                            const store = transaction.objectStore(this.indexedDB.stores.INSPECTIONS);
                            const request = store.delete(inspection.id);
                            
                            request.onsuccess = () => resolve();
                            request.onerror = () => reject(request.error);
                        });
                    });
                    
                    Promise.all(deletePromises).then(() => {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                        this.state.inspectionsDatabase = this.state.inspectionsDatabase.filter(i => i.status !== 'completed');
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º UI
                        this.loadInspectionsList();
                        this.updateStatistics();
                        
                        this.playSound('success');
                        this.showToast(`–£–¥–∞–ª–µ–Ω–æ ${completedInspections.length} –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫`, 'success');
                    }).catch(error => {
                        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫:', error);
                        this.playSound('error');
                        this.showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä–æ–∫', 'warning');
                    });
                    
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫:', e);
                    this.playSound('error');
                    this.showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –ø—Ä–æ–≤–µ—Ä–æ–∫', 'warning');
                }
            },
            checkInspectionReminders() {
                const reminderTime = parseInt(document.getElementById('reminderTime')?.value || 2, 10);
                const now = new Date();
                const reminderMs = reminderTime * 60 * 60 * 1000;
                this.state.inspectionsDatabase.forEach(inspection => {
                    if (inspection.status !== 'planned' || inspection.reminded) return;
                    const inspectionDateTime = new Date(inspection.date + 'T' + inspection.time);
                    const timeUntilInspection = inspectionDateTime - now;
                    if (timeUntilInspection > 0 && timeUntilInspection <= reminderMs) {
                        this.showToast(
                            `–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä–∫–∞ ${inspection.brand} ${inspection.model} –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ ${inspection.date} ${inspection.time}`,
                            'info'
                        );
                        this.playSound('warning');
                        inspection.reminded = true;
                        this.saveInspectionToIndexedDB(inspection);
                    }
                });
                setTimeout(() => this.checkInspectionReminders(), 30 * 60 * 1000);
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            try {
                app.init();
                const searchReports = document.getElementById('searchReports');
                if (searchReports) {
                    searchReports.addEventListener('input', () => app.loadReportsList());
                }
                const searchInspections = document.getElementById('searchInspections');
                if (searchInspections) {
                    searchInspections.addEventListener('input', () => app.loadInspectionsList());
                }
                const updateStatsBtn = document.getElementById('updateStatsBtn');
                if (updateStatsBtn) {
                    updateStatsBtn.addEventListener('click', () => {
                        app.updateStatistics();
                        app.playSound('click');
                    });
                }
                // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                const now = new Date();
                const oneMonthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
                const startDateEl = document.getElementById('startDate');
                const endDateEl = document.getElementById('endDate');
                if (startDateEl) startDateEl.value = oneMonthAgo.toISOString().split('T')[0];
                if (endDateEl) endDateEl.value = now.toISOString().split('T')[0];
                
                const generateStatsBtn = document.getElementById('generateStatsBtn');
                if (generateStatsBtn) {
                    generateStatsBtn.addEventListener('click', () => {
                        const statsOutput = document.getElementById('statsOutput');
                        const copyStatsBtn = document.getElementById('copyStatsBtn');
                        if (statsOutput) {
                            const startDateEl = document.getElementById('startDate');
                            const endDateEl = document.getElementById('endDate');
                            let startDate = startDateEl ? new Date(startDateEl.value) : null;
                            let endDate = endDateEl ? new Date(endDateEl.value) : null;

                            if (!startDate || isNaN(startDate.getTime())) {
                                startDate = new Date(0);
                            }
                            if (!endDate || isNaN(endDate.getTime())) {
                                endDate = new Date();
                            }

                            const periodReports = app.state.reportsDatabase.filter(r => {
                                const reportDate = new Date(r.timestamp);
                                return reportDate >= startDate && reportDate <= endDate;
                            });

                            const totalReports = periodReports.length;
                            const purchasedCount = periodReports.filter(r => r.decision === '‚úÖ –ö—É–ø–ª–µ–Ω').length;
                            const notPurchasedCount = periodReports.filter(r => r.decision === '‚ùå –ù–µ –ö—É–ø–ª–µ–Ω').length;
                            const pendingCount = periodReports.filter(r => r.decision === '‚è≥ –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ').length;

                            // –ö–ª–∞—Å—Å—ã –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤
                            const classCounts = {};
                            periodReports.forEach(r => {
                                if (r.motorcycle_class) {
                                    classCounts[r.motorcycle_class] = (classCounts[r.motorcycle_class] || 0) + 1;
                                }
                            });
                            const classString = Object.keys(classCounts).map(cls => `${cls}: ${classCounts[cls]}`).join(', ') || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';

                            // –ü–æ–ø—É–ª—è—Ä–Ω–∞—è –º–∞—Ä–∫–∞
                            const brandCounts = {};
                            periodReports.forEach(r => {
                                if (r.brand) {
                                    brandCounts[r.brand] = (brandCounts[r.brand] || 0) + 1;
                                }
                            });
                            const brandKeys = Object.keys(brandCounts);
                            const popularBrand = brandKeys.length > 0 ? 
                                brandKeys.reduce((a, b) => brandCounts[a] > brandCounts[b] ? a : b) : 
                                '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';

                            // –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞
                            let totalPrice = 0;
                            let priceCount = 0;
                            periodReports.forEach(r => {
                                const price = app.parseMoneyValue(r.price);
                                if (price > 0) {
                                    totalPrice += price;
                                    priceCount++;
                                }
                            });
                            const avgPrice = priceCount > 0 ? totalPrice / priceCount : 0;

                            statsOutput.textContent = `üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Motopodbor.ru PRO\n\n` +
                                `üìÖ –ü–µ—Ä–∏–æ–¥: ${startDate.toLocaleDateString('ru-RU')} - ${endDate.toLocaleDateString('ru-RU')}\n` +
                                `üèçÔ∏è –í—Å–µ–≥–æ –æ—Ç—á–µ—Ç–æ–≤: ${totalReports}\n` +
                                `üìä –ö–ª–∞—Å—Å—ã –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤: ${classString}\n` +
                                `üèÜ –ü–æ–ø—É–ª—è—Ä–Ω–∞—è –º–∞—Ä–∫–∞: ${popularBrand}\n` +
                                `üíµ –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞: ${app.formatMoney(Math.round(avgPrice))}\n` +
                                `‚úÖ –ö—É–ø–ª–µ–Ω–æ: ${purchasedCount}\n` +
                                `‚ùå –ù–µ –∫—É–ø–ª–µ–Ω–æ: ${notPurchasedCount}\n` +
                                `‚è≥ –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏: ${pendingCount}`;

                            statsOutput.classList.remove('hidden');
                        }
                        if (copyStatsBtn) {
                            copyStatsBtn.classList.remove('hidden');
                            copyStatsBtn.onclick = () => {
                                navigator.clipboard.writeText(statsOutput.textContent).then(() => {
                                    app.playSound('success');
                                    app.showToast('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
                                });
                            };
                        }
                        app.playSound('success');
                    });
                }
            } catch (e) {
                console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', e);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
            }
        });
    </script>
</body>
</html>
